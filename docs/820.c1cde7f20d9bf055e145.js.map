{"version":3,"file":"820.c1cde7f20d9bf055e145.js","mappings":"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","sources":["webpack://babylonjs-fluid-rendering/./src/scenes/FluidRenderer/fluidRendererGUI.ts","webpack://babylonjs-fluid-rendering/./src/scenes/FluidSimulator2/fluidSimulator.ts","webpack://babylonjs-fluid-rendering/./src/scenes/FluidSimulator2/hash.ts","webpack://babylonjs-fluid-rendering/./src/scenes/Utils/particleGenerator.ts","webpack://babylonjs-fluid-rendering/./src/assets/materials/sulphuric-rock_albedo.png","webpack://babylonjs-fluid-rendering/./src/assets/materials/sulphuric-rock_roughness.png","webpack://babylonjs-fluid-rendering/./src/assets/materials/sulphuric-rock_normal-ogl.png","webpack://babylonjs-fluid-rendering/./src/assets/materials/Marble08_1K_BaseColor.png","webpack://babylonjs-fluid-rendering/./src/scenes/Utils/sdfHelper.ts","webpack://babylonjs-fluid-rendering/./src/scenes/fluidSimulationDemoBase.ts"],"sourcesContent":["import * as BABYLON from \"@babylonjs/core\";\n\nimport * as LiLGUI from \"lil-gui\";\nimport { FluidRenderingDebug } from \"./fluidRenderingTargetRenderer\";\n/*\nasync function LoadDAT(): Promise<void> {\n    const _ = await import(\"@babylonjs/core/Misc/tools\")\n    return _.Tools.LoadScriptAsync(\"https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js\");\n}\n*/\nexport class FluidRendererGUI {\n    private _gui: BABYLON.Nullable<LiLGUI.GUI>;\n    private _visible: boolean;\n    private _scene: BABYLON.Scene;\n    private _showGeneralMenu: boolean;\n    private _onKeyObserver: BABYLON.Nullable<\n        BABYLON.Observer<BABYLON.KeyboardInfo>\n    >;\n    private _targetRendererIndex: number;\n    private _targetRenderersGUIElements: LiLGUI.Controller[];\n    private _renderObjectIndex: number;\n    private _renderObjectsGUIElements: LiLGUI.Controller[];\n\n    public set visible(v: boolean) {\n        if (v === this._visible) {\n            return;\n        }\n        this._visible = v;\n        if (this._gui) {\n            this._gui.domElement.style.display = v ? \"\" : \"none\";\n        }\n    }\n\n    constructor(scene: BABYLON.Scene, showGeneralMenu = true) {\n        this._scene = scene;\n        this._showGeneralMenu = showGeneralMenu;\n        this._visible = false;\n        this._onKeyObserver = null;\n        this._targetRendererIndex = 0;\n        this._targetRenderersGUIElements = [];\n        this._renderObjectIndex = 0;\n        this._renderObjectsGUIElements = [];\n        this._gui = null;\n\n        this.initialize();\n    }\n\n    public dispose() {\n        const oldgui = document.getElementById(\"datGUI\");\n        if (oldgui !== null) {\n            oldgui.remove();\n            this._gui = null;\n        }\n        this._scene.onKeyboardObservable.remove(this._onKeyObserver);\n        this._onKeyObserver = null;\n    }\n\n    private _setupKeyboard(): void {\n        this._onKeyObserver = this._scene.onKeyboardObservable.add((kbInfo) => {\n            switch (kbInfo.type) {\n                case BABYLON.KeyboardEventTypes.KEYDOWN:\n                    //console.log(\"KEY DOWN: \", kbInfo.event.key);\n                    break;\n                case BABYLON.KeyboardEventTypes.KEYUP:\n                    switch (kbInfo.event.key) {\n                        case \"F8\": {\n                            this.visible = !this._visible;\n                            break;\n                        }\n                    }\n                    //console.log(\"KEY UP: \", kbInfo.event.key, kbInfo.event.keyCode);\n                    break;\n            }\n        });\n    }\n\n    public initialize(): void {\n        this.dispose();\n\n        this._gui = new LiLGUI.GUI({ title: \"Fluid Rendering\" });\n        this._gui.domElement.style.display = \"none\";\n        this._gui.domElement.style.marginTop = \"60px\";\n        this._gui.domElement.id = \"datGUI\";\n\n        this._setupKeyboard();\n\n        if (this._showGeneralMenu) {\n            this._makeMenuGeneral();\n        }\n        this._makeMenuTargetRenderers();\n        this._makeMenuRenderObjects();\n    }\n\n    private _addList(\n        menu: LiLGUI.GUI,\n        params: object,\n        name: string,\n        friendlyName: string,\n        list: any[]\n    ): LiLGUI.Controller {\n        return menu\n            .add(params, name, list)\n            .name(friendlyName)\n            .onChange((value: any) => {\n                this._parameterChanged(name, value);\n            });\n    }\n\n    private _addCheckbox(\n        menu: LiLGUI.GUI,\n        params: object,\n        name: string,\n        friendlyName: string\n    ): LiLGUI.Controller {\n        return menu\n            .add(params, name)\n            .name(friendlyName)\n            .onChange((value: any) => {\n                this._parameterChanged(name, value);\n            });\n    }\n\n    private _addSlider(\n        menu: LiLGUI.GUI,\n        params: object,\n        name: string,\n        friendlyName: string,\n        min: number,\n        max: number,\n        step: number\n    ): LiLGUI.Controller {\n        return menu\n            .add(params, name, min, max, step)\n            .name(friendlyName)\n            .onChange((value: any) => {\n                this._parameterChanged(name, value);\n            });\n    }\n\n    private _addColor(\n        menu: LiLGUI.GUI,\n        params: object,\n        name: string,\n        friendlyName: string\n    ): LiLGUI.Controller {\n        return menu\n            .addColor(params, name)\n            .name(friendlyName)\n            .onChange((value: any) => {\n                this._parameterChanged(name, value);\n            });\n    }\n\n    private _makeMenuGeneral(): void {\n        if (!this._gui) {\n            return;\n        }\n\n        const params = {\n            enable: this._parameterRead(\"enable\"),\n        };\n\n        const general = this._gui.addFolder(\"General\");\n\n        general.$title.style.fontWeight = \"bold\";\n\n        this._addCheckbox(general, params, \"enable\", \"Enable fluid renderer\");\n\n        general.open();\n    }\n\n    private _makeMenuTargetRenderers(): void {\n        if (\n            !this._gui ||\n            !(this._scene.fluidRenderer?.targetRenderers.length ?? 0)\n        ) {\n            return;\n        }\n\n        const params = {\n            targets_index: this._parameterRead(\"targets_index\"),\n            targets_generateDiffuseTexture: this._parameterRead(\n                \"targets_generateDiffuseTexture\"\n            ),\n            targets_fluidColor: this._parameterRead(\"targets_fluidColor\"),\n            targets_surfaceColor: this._parameterRead(\"targets_surfaceColor\"),\n            targets_density: this._parameterRead(\"targets_density\"),\n            targets_refractionStrength: this._parameterRead(\n                \"targets_refractionStrength\"\n            ),\n            targets_fresnelClamp: this._parameterRead(\"targets_fresnelClamp\"),\n            targets_specularPower: this._parameterRead(\"targets_specularPower\"),\n            targets_minimumThickness: this._parameterRead(\n                \"targets_minimumThickness\"\n            ),\n            targets_debug: this._parameterRead(\"targets_debug\"),\n            targets_debugFeature: this._parameterRead(\"targets_debugFeature\"),\n            targets_enableBlurDepth: this._parameterRead(\n                \"targets_enableBlurDepth\"\n            ),\n            targets_blurDepthSizeDivisor: this._parameterRead(\n                \"targets_blurDepthSizeDivisor\"\n            ),\n            targets_blurDepthFilterSize: this._parameterRead(\n                \"targets_blurDepthFilterSize\"\n            ),\n            targets_blurDepthNumIterations: this._parameterRead(\n                \"targets_blurDepthNumIterations\"\n            ),\n            targets_blurDepthMaxFilterSize: this._parameterRead(\n                \"targets_blurDepthMaxFilterSize\"\n            ),\n            targets_blurDepthDepthScale: this._parameterRead(\n                \"targets_blurDepthDepthScale\"\n            ),\n            targets_enableBlurThickness: this._parameterRead(\n                \"targets_enableBlurThickness\"\n            ),\n            targets_blurThicknessSizeDivisor: this._parameterRead(\n                \"targets_blurThicknessSizeDivisor\"\n            ),\n            targets_blurThicknessFilterSize: this._parameterRead(\n                \"targets_blurThicknessFilterSize\"\n            ),\n            targets_blurThicknessNumIterations: this._parameterRead(\n                \"targets_blurThicknessNumIterations\"\n            ),\n            targets_depthMapSize: this._parameterRead(\"targets_depthMapSize\"),\n            targets_thicknessMapSize: this._parameterRead(\n                \"targets_thicknessMapSize\"\n            ),\n            targets_diffuseMapSize: this._parameterRead(\n                \"targets_diffuseMapSize\"\n            ),\n            targets_useVelocity: this._parameterRead(\"targets_useVelocity\"),\n            targets_useFixedThickness: this._parameterRead(\n                \"targets_useFixedThickness\"\n            ),\n        };\n\n        const targetRenderers = this._gui.addFolder(\"Target renderers\");\n        targetRenderers.$title.style.fontWeight = \"bold\";\n\n        const targetList: number[] = [];\n        if (this._scene.fluidRenderer) {\n            for (\n                let i = 0;\n                i < this._scene.fluidRenderer.targetRenderers.length;\n                ++i\n            ) {\n                targetList.push(i);\n            }\n        }\n\n        this._addList(\n            targetRenderers,\n            params,\n            \"targets_index\",\n            \"Index\",\n            targetList\n        );\n        this._targetRenderersGUIElements.push(\n            this._addList(\n                targetRenderers,\n                params,\n                \"targets_depthMapSize\",\n                \"Depth map size\",\n                [\"Screen size\", 256, 512, 1024, 2048, 4096]\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addList(\n                targetRenderers,\n                params,\n                \"targets_thicknessMapSize\",\n                \"Thickness map size\",\n                [\"Screen size\", 64, 128, 256, 512, 1024, 2048]\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addList(\n                targetRenderers,\n                params,\n                \"targets_diffuseMapSize\",\n                \"Diffuse map size\",\n                [\"Screen size\", 256, 512, 1024, 2048, 4096]\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                targetRenderers,\n                params,\n                \"targets_minimumThickness\",\n                \"Minimum thickness\",\n                0,\n                3,\n                0.001\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addCheckbox(\n                targetRenderers,\n                params,\n                \"targets_useFixedThickness\",\n                \"Use fixed thickness\"\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addCheckbox(\n                targetRenderers,\n                params,\n                \"targets_useVelocity\",\n                \"Use velocity\"\n            )\n        );\n\n        const menuColor = targetRenderers.addFolder(\"Color\");\n        menuColor.$title.style.fontStyle = \"italic\";\n\n        this._targetRenderersGUIElements.push(\n            this._addCheckbox(\n                menuColor,\n                params,\n                \"targets_generateDiffuseTexture\",\n                \"Generate diffuse texture\"\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addColor(\n                menuColor,\n                params,\n                \"targets_fluidColor\",\n                \"Fluid color\"\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addColor(\n                menuColor,\n                params,\n                \"targets_surfaceColor\",\n                \"Surface color\"\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuColor,\n                params,\n                \"targets_density\",\n                \"Density\",\n                0,\n                20,\n                0.01\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuColor,\n                params,\n                \"targets_refractionStrength\",\n                \"Refraction strength\",\n                0,\n                0.3,\n                0.005\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuColor,\n                params,\n                \"targets_fresnelClamp\",\n                \"Fresnel clamp\",\n                0,\n                1.0,\n                0.005\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuColor,\n                params,\n                \"targets_specularPower\",\n                \"Specular power\",\n                1,\n                5000,\n                5\n            )\n        );\n\n        const menuBlurDepth = targetRenderers.addFolder(\"Blur Depth\");\n        menuBlurDepth.$title.style.fontStyle = \"italic\";\n\n        this._targetRenderersGUIElements.push(\n            this._addCheckbox(\n                menuBlurDepth,\n                params,\n                \"targets_enableBlurDepth\",\n                \"Enable\"\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuBlurDepth,\n                params,\n                \"targets_blurDepthSizeDivisor\",\n                \"Size divisor\",\n                1,\n                10,\n                1\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuBlurDepth,\n                params,\n                \"targets_blurDepthFilterSize\",\n                \"Filter size\",\n                1,\n                20,\n                1\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuBlurDepth,\n                params,\n                \"targets_blurDepthNumIterations\",\n                \"Num iterations\",\n                1,\n                10,\n                1\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuBlurDepth,\n                params,\n                \"targets_blurDepthMaxFilterSize\",\n                \"Max filter size\",\n                1,\n                100,\n                1\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuBlurDepth,\n                params,\n                \"targets_blurDepthDepthScale\",\n                \"Depth scale\",\n                0,\n                100,\n                0.01\n            )\n        );\n\n        const menuBlurThickness = targetRenderers.addFolder(\"Blur Thickness\");\n        menuBlurThickness.$title.style.fontStyle = \"italic\";\n\n        this._targetRenderersGUIElements.push(\n            this._addCheckbox(\n                menuBlurThickness,\n                params,\n                \"targets_enableBlurThickness\",\n                \"Enable\"\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuBlurThickness,\n                params,\n                \"targets_blurThicknessSizeDivisor\",\n                \"Size divisor\",\n                1,\n                10,\n                1\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuBlurThickness,\n                params,\n                \"targets_blurThicknessFilterSize\",\n                \"Filter size\",\n                1,\n                20,\n                1\n            )\n        );\n        this._targetRenderersGUIElements.push(\n            this._addSlider(\n                menuBlurThickness,\n                params,\n                \"targets_blurThicknessNumIterations\",\n                \"Num iterations\",\n                1,\n                10,\n                1\n            )\n        );\n\n        const menuDebug = targetRenderers.addFolder(\"Debug\");\n        menuDebug.$title.style.fontStyle = \"italic\";\n\n        this._targetRenderersGUIElements.push(\n            this._addCheckbox(menuDebug, params, \"targets_debug\", \"Enable\")\n        );\n        this._targetRenderersGUIElements.push(\n            this._addList(\n                menuDebug,\n                params,\n                \"targets_debugFeature\",\n                \"Feature\",\n                Object.keys(FluidRenderingDebug).filter((k) => isNaN(Number(k)))\n            )\n        );\n\n        targetRenderers.open();\n    }\n\n    private _makeMenuRenderObjects(): void {\n        if (\n            !this._gui ||\n            !(this._scene.fluidRenderer?.renderObjects.length ?? 0)\n        ) {\n            return;\n        }\n\n        const params = {\n            objects_index: this._parameterRead(\"objects_index\"),\n            objects_particleSize: this._parameterRead(\"objects_particleSize\"),\n            objects_particleThicknessAlpha: this._parameterRead(\n                \"objects_particleThicknessAlpha\"\n            ),\n        };\n\n        const renderObjects = this._gui.addFolder(\"Render objects\");\n        renderObjects.$title.style.fontWeight = \"bold\";\n\n        const objectList: number[] = [];\n        if (this._scene.fluidRenderer) {\n            for (\n                let i = 0;\n                i < this._scene.fluidRenderer.renderObjects.length;\n                ++i\n            ) {\n                objectList.push(i);\n            }\n        }\n\n        this._addList(\n            renderObjects,\n            params,\n            \"objects_index\",\n            \"Index\",\n            objectList\n        );\n        this._renderObjectsGUIElements.push(\n            this._addSlider(\n                renderObjects,\n                params,\n                \"objects_particleSize\",\n                \"Particle size\",\n                0,\n                2,\n                0.001\n            )\n        );\n        this._renderObjectsGUIElements.push(\n            this._addSlider(\n                renderObjects,\n                params,\n                \"objects_particleThicknessAlpha\",\n                \"Particle alpha\",\n                0,\n                1,\n                0.001\n            )\n        );\n    }\n\n    private _readValue(obj: any, name: string): any {\n        const parts: string[] = name.split(\"_\");\n\n        for (let i = 0; i < parts.length; ++i) {\n            const part = parts[i];\n            obj = obj[parts[i]];\n\n            if (obj instanceof BABYLON.Color3) {\n                obj = obj.toHexString();\n            }\n\n            if (part === \"debugFeature\") {\n                obj = FluidRenderingDebug[obj];\n            }\n\n            if (part.endsWith(\"MapSize\") && obj === null) {\n                obj = \"Screen size\";\n            }\n        }\n\n        return obj;\n    }\n\n    private _setValue(obj: any, name: string, value: any): void {\n        const parts: string[] = name.split(\"_\");\n\n        for (let i = 0; i < parts.length - 1; ++i) {\n            obj = obj[parts[i]];\n            if (parts[i].endsWith(\"MapSize\") && value === \"Screen size\") {\n                value = null;\n            }\n        }\n\n        if (\n            parts[parts.length - 1].endsWith(\"MapSize\") &&\n            value === \"Screen size\"\n        ) {\n            value = null;\n        }\n\n        obj[parts[parts.length - 1]] = value;\n    }\n\n    private _parameterRead(name: string): any {\n        const fluidRenderer = this._scene.fluidRenderer;\n        switch (name) {\n            case \"enable\":\n                return !!this._scene.fluidRenderer;\n        }\n\n        if (name.startsWith(\"targets_\")) {\n            name = name.substring(8);\n            if (name === \"index\") {\n                return this._targetRendererIndex;\n            } else {\n                return fluidRenderer\n                    ? this._readValue(\n                          fluidRenderer.targetRenderers[\n                              this._targetRendererIndex\n                          ],\n                          name\n                      )\n                    : \"\";\n            }\n        }\n\n        if (name.startsWith(\"objects_\")) {\n            name = name.substring(8);\n            if (name === \"index\") {\n                return this._renderObjectIndex;\n            } else {\n                return fluidRenderer\n                    ? this._readValue(\n                          fluidRenderer.renderObjects[this._renderObjectIndex]\n                              .object,\n                          name\n                      )\n                    : \"\";\n            }\n        }\n    }\n\n    private _fillValues(listGUIElements: LiLGUI.Controller[], obj: any): void {\n        for (let i = 0; i < listGUIElements.length; ++i) {\n            const elem = listGUIElements[i];\n            const property = elem.property.split(\"_\")[1];\n            (elem.object as any)[elem.property] = this._readValue(\n                obj,\n                property\n            );\n            elem.updateDisplay();\n        }\n    }\n\n    public syncGUI(): void {\n        const fluidRenderer = this._scene.fluidRenderer;\n\n        if (fluidRenderer) {\n            this._fillValues(\n                this._targetRenderersGUIElements,\n                fluidRenderer.targetRenderers[this._targetRendererIndex]\n            );\n            this._fillValues(\n                this._renderObjectsGUIElements,\n                fluidRenderer.renderObjects[this._renderObjectIndex].object\n            );\n        }\n    }\n\n    private _parameterChanged(name: string, value: any): void {\n        const fluidRenderer = this._scene.fluidRenderer;\n        switch (name) {\n            case \"enable\":\n                if (value) {\n                    this._scene.enableFluidRenderer();\n                    this._targetRendererIndex = 0;\n                    this.initialize();\n                } else {\n                    this._scene.disableFluidRenderer();\n                    this._targetRendererIndex = 0;\n                    this.initialize();\n                }\n                return;\n            case \"targets_fluidColor\":\n                if (\n                    fluidRenderer &&\n                    fluidRenderer.targetRenderers.length >\n                        this._targetRendererIndex\n                ) {\n                    fluidRenderer.targetRenderers[\n                        this._targetRendererIndex\n                    ].fluidColor.copyFrom(BABYLON.Color3.FromHexString(value));\n                }\n                return;\n            case \"targets_surfaceColor\":\n                if (\n                    fluidRenderer &&\n                    fluidRenderer.targetRenderers.length >\n                        this._targetRendererIndex\n                ) {\n                    fluidRenderer.targetRenderers[\n                        this._targetRendererIndex\n                    ].surfaceColor.copyFrom(BABYLON.Color3.FromHexString(value));\n                }\n                return;\n            case \"targets_debugFeature\": {\n                const typedDebugFeature: keyof typeof FluidRenderingDebug =\n                    value;\n                const val = FluidRenderingDebug[typedDebugFeature];\n                if (\n                    fluidRenderer &&\n                    fluidRenderer.targetRenderers.length >\n                        this._targetRendererIndex\n                ) {\n                    fluidRenderer.targetRenderers[\n                        this._targetRendererIndex\n                    ].debugFeature = val;\n                }\n                return;\n            }\n        }\n\n        if (name.startsWith(\"targets_\")) {\n            name = name.substring(8);\n            if (name === \"index\") {\n                this._targetRendererIndex = value || 0;\n                if (fluidRenderer) {\n                    this._fillValues(\n                        this._targetRenderersGUIElements,\n                        fluidRenderer.targetRenderers[this._targetRendererIndex]\n                    );\n                }\n            } else {\n                if (fluidRenderer) {\n                    this._setValue(\n                        fluidRenderer.targetRenderers[\n                            this._targetRendererIndex\n                        ],\n                        name,\n                        value === false\n                            ? false\n                            : value === true\n                            ? true\n                            : isNaN(value)\n                            ? value\n                            : parseFloat(value)\n                    );\n                }\n            }\n        }\n\n        if (name.startsWith(\"objects_\")) {\n            name = name.substring(8);\n            if (name === \"index\") {\n                this._renderObjectIndex = value || 0;\n                if (fluidRenderer) {\n                    this._fillValues(\n                        this._renderObjectsGUIElements,\n                        fluidRenderer.renderObjects[this._renderObjectIndex]\n                            .object\n                    );\n                }\n            } else {\n                if (fluidRenderer) {\n                    this._setValue(\n                        fluidRenderer.renderObjects[this._renderObjectIndex]\n                            .object,\n                        name,\n                        value === false\n                            ? false\n                            : value === true\n                            ? true\n                            : isNaN(value)\n                            ? value\n                            : parseFloat(value)\n                    );\n                }\n            }\n        }\n    }\n}\n","import * as BABYLON from \"@babylonjs/core\";\nimport { Hash } from \"./hash\";\n\n// Based on https://github.com/rlguy/SPHFluidSim/blob/master/src/sphfluidsimulation.cpp\n\nexport interface IFluidParticle {\n    mass: number;\n    density: number;\n    pressure: number;\n    accelX: number;\n    accelY: number;\n    accelZ: number;\n}\n\nexport class FluidSimulator {\n    protected _particles: IFluidParticle[];\n    protected _numMaxParticles: number;\n    protected _positions: Float32Array;\n    protected _velocities: Float32Array;\n    protected _hash: Hash;\n\n    protected _smoothingRadius2: number;\n    protected _poly6Constant: number;\n    protected _spikyConstant: number;\n    protected _viscConstant: number;\n\n    protected _smoothingRadius = 0.2;\n\n    public get smoothingRadius() {\n        return this._smoothingRadius;\n    }\n\n    public set smoothingRadius(radius: number) {\n        this._smoothingRadius = radius;\n        this._computeConstants();\n    }\n\n    public densityReference = 2000;\n\n    public pressureConstant = 20;\n\n    public viscosity = 0.005;\n\n    public gravity = new BABYLON.Vector3(0, -9.8, 0);\n\n    public minTimeStep = 1 / 100;\n\n    public maxVelocity = 75;\n\n    public maxAcceleration = 2000;\n\n    public currentNumParticles: number;\n\n    private _mass: number;\n\n    public get mass() {\n        return this._mass;\n    }\n\n    public set mass(m: number) {\n        for (let i = 0; i < this._particles.length; ++i) {\n            this._particles[i].mass = m;\n        }\n    }\n\n    private _computeConstants(): void {\n        this._smoothingRadius2 = this._smoothingRadius * this._smoothingRadius;\n        this._poly6Constant =\n            315 / (64 * Math.PI * Math.pow(this._smoothingRadius, 9));\n        this._spikyConstant =\n            -45 / (Math.PI * Math.pow(this._smoothingRadius, 6));\n        this._viscConstant =\n            45 / (Math.PI * Math.pow(this._smoothingRadius, 6));\n        this._hash = new Hash(this._smoothingRadius, this._numMaxParticles);\n    }\n\n    public get positions() {\n        return this._positions;\n    }\n\n    public get velocities() {\n        return this._velocities;\n    }\n\n    public get numMaxParticles() {\n        return this._numMaxParticles;\n    }\n\n    public setParticleData(\n        positions?: Float32Array,\n        velocities?: Float32Array\n    ): void {\n        this._positions = positions ?? new Float32Array();\n        this._velocities = velocities ?? new Float32Array();\n        this._numMaxParticles = this._positions.length / 3;\n        this._hash = new Hash(this._smoothingRadius, this._numMaxParticles);\n\n        for (let i = this._particles.length; i < this._numMaxParticles; ++i) {\n            this._particles.push({\n                mass: this.mass,\n                density: 0,\n                pressure: 0,\n                accelX: 0,\n                accelY: 0,\n                accelZ: 0,\n            });\n        }\n    }\n\n    constructor(positions?: Float32Array, velocities?: Float32Array, mass = 1) {\n        this._positions = undefined as any;\n        this._velocities = undefined as any;\n        this._particles = [];\n        this._numMaxParticles = 0;\n        this._mass = mass;\n\n        if (positions && velocities) {\n            this.setParticleData(positions, velocities);\n        }\n\n        this._hash = new Hash(this._smoothingRadius, this._numMaxParticles);\n\n        this.currentNumParticles = this._numMaxParticles;\n\n        this._smoothingRadius2 = 0;\n        this._poly6Constant = 0;\n        this._spikyConstant = 0;\n        this._viscConstant = 0;\n\n        this._computeConstants();\n    }\n\n    public update(deltaTime: number): void {\n        let timeLeft = deltaTime;\n\n        while (timeLeft > 0) {\n            this._hash.create(this._positions, this.currentNumParticles);\n            this._computeDensityAndPressure();\n            this._computeAcceleration();\n\n            let timeStep = this._calculateTimeStep();\n\n            timeLeft -= timeStep;\n            if (timeLeft < 0) {\n                timeStep += timeLeft;\n                timeLeft = 0;\n            }\n\n            this._updatePositions(timeStep);\n        }\n    }\n\n    public dispose(): void {\n        // nothing to do\n    }\n\n    protected _computeDensityAndPressure(): void {\n        for (let a = 0; a < this.currentNumParticles; ++a) {\n            const pA = this._particles[a];\n            const paX = this._positions[a * 3 + 0];\n            const paY = this._positions[a * 3 + 1];\n            const paZ = this._positions[a * 3 + 2];\n\n            pA.density = 0;\n\n            this._hash.query(this._positions, a, this._smoothingRadius);\n\n            for (let ib = 0; ib < this._hash.querySize; ++ib) {\n                const b = this._hash.queryIds[ib];\n                const diffX = paX - this._positions[b * 3 + 0];\n                const diffY = paY - this._positions[b * 3 + 1];\n                const diffZ = paZ - this._positions[b * 3 + 2];\n                const r2 = diffX * diffX + diffY * diffY + diffZ * diffZ;\n\n                if (r2 < this._smoothingRadius2) {\n                    const w =\n                        this._poly6Constant *\n                        Math.pow(this._smoothingRadius2 - r2, 3);\n                    pA.density += w;\n                }\n            }\n\n            pA.density = Math.max(this.densityReference, pA.density);\n            pA.pressure =\n                this.pressureConstant * (pA.density - this.densityReference);\n        }\n    }\n\n    protected _computeAcceleration(): void {\n        // Pressurce-based acceleration + viscosity-based acceleration computation\n        for (let a = 0; a < this.currentNumParticles; ++a) {\n            const pA = this._particles[a];\n            const paX = this._positions[a * 3 + 0];\n            const paY = this._positions[a * 3 + 1];\n            const paZ = this._positions[a * 3 + 2];\n\n            const vaX = this._velocities[a * 3 + 0];\n            const vaY = this._velocities[a * 3 + 1];\n            const vaZ = this._velocities[a * 3 + 2];\n\n            let pressureAccelX = 0;\n            let pressureAccelY = 0;\n            let pressureAccelZ = 0;\n\n            let viscosityAccelX = 0;\n            let viscosityAccelY = 0;\n            let viscosityAccelZ = 0;\n\n            this._hash.query(this._positions, a, this._smoothingRadius);\n\n            for (let ib = 0; ib < this._hash.querySize; ++ib) {\n                const b = this._hash.queryIds[ib];\n                let diffX = paX - this._positions[b * 3 + 0];\n                let diffY = paY - this._positions[b * 3 + 1];\n                let diffZ = paZ - this._positions[b * 3 + 2];\n                const r2 = diffX * diffX + diffY * diffY + diffZ * diffZ;\n                const r = Math.sqrt(r2);\n\n                if (r > 0 && r2 < this._smoothingRadius2) {\n                    const pB = this._particles[b];\n\n                    diffX /= r;\n                    diffY /= r;\n                    diffZ /= r;\n\n                    const w =\n                        this._spikyConstant *\n                        (this._smoothingRadius - r) *\n                        (this._smoothingRadius - r);\n                    const massRatio = pB.mass / pA.mass;\n                    const fp =\n                        w *\n                        ((pA.pressure + pB.pressure) /\n                            (2 * pA.density * pB.density)) *\n                        massRatio;\n\n                    pressureAccelX -= fp * diffX;\n                    pressureAccelY -= fp * diffY;\n                    pressureAccelZ -= fp * diffZ;\n\n                    const w2 = this._viscConstant * (this._smoothingRadius - r);\n                    const fv =\n                        w2 * (1 / pB.density) * massRatio * this.viscosity;\n\n                    viscosityAccelX += fv * (this._velocities[b * 3 + 0] - vaX);\n                    viscosityAccelY += fv * (this._velocities[b * 3 + 1] - vaY);\n                    viscosityAccelZ += fv * (this._velocities[b * 3 + 2] - vaZ);\n                }\n            }\n\n            pA.accelX = pressureAccelX + viscosityAccelX;\n            pA.accelY = pressureAccelY + viscosityAccelY;\n            pA.accelZ = pressureAccelZ + viscosityAccelZ;\n\n            pA.accelX += this.gravity.x;\n            pA.accelY += this.gravity.y;\n            pA.accelZ += this.gravity.z;\n\n            const mag = Math.sqrt(\n                pA.accelX * pA.accelX +\n                    pA.accelY * pA.accelY +\n                    pA.accelZ * pA.accelZ\n            );\n\n            if (mag > this.maxAcceleration) {\n                pA.accelX = (pA.accelX / mag) * this.maxAcceleration;\n                pA.accelY = (pA.accelY / mag) * this.maxAcceleration;\n                pA.accelZ = (pA.accelZ / mag) * this.maxAcceleration;\n            }\n        }\n    }\n\n    protected _calculateTimeStep() {\n        let maxVelocity = 0;\n        let maxAcceleration = 0;\n        let maxSpeedOfSound = 0;\n\n        for (let a = 0; a < this.currentNumParticles; ++a) {\n            const pA = this._particles[a];\n\n            const velSq =\n                this._velocities[a * 3 + 0] * this._velocities[a * 3 + 0] +\n                this._velocities[a * 3 + 1] * this._velocities[a * 3 + 1] +\n                this._velocities[a * 3 + 2] * this._velocities[a * 3 + 2];\n            const accSq =\n                pA.accelX * pA.accelX +\n                pA.accelY * pA.accelY +\n                pA.accelZ * pA.accelZ;\n            const spsSq = pA.density < 0.00001 ? 0 : pA.pressure / pA.density;\n\n            if (velSq > maxVelocity) {\n                maxVelocity = velSq;\n            }\n            if (accSq > maxAcceleration) {\n                maxAcceleration = accSq;\n            }\n            if (spsSq > maxSpeedOfSound) {\n                maxSpeedOfSound = spsSq;\n            }\n        }\n\n        maxVelocity = Math.sqrt(maxVelocity);\n        maxAcceleration = Math.sqrt(maxAcceleration);\n        maxSpeedOfSound = Math.sqrt(maxSpeedOfSound);\n\n        const velStep = (0.4 * this.smoothingRadius) / Math.max(1, maxVelocity);\n        const accStep = 0.4 * Math.sqrt(this.smoothingRadius / maxAcceleration);\n        const spsStep = this.smoothingRadius / maxSpeedOfSound;\n\n        return Math.max(this.minTimeStep, Math.min(velStep, accStep, spsStep));\n    }\n\n    protected _updatePositions(deltaTime: number): void {\n        for (let a = 0; a < this.currentNumParticles; ++a) {\n            const pA = this._particles[a];\n\n            this._velocities[a * 3 + 0] += pA.accelX * deltaTime;\n            this._velocities[a * 3 + 1] += pA.accelY * deltaTime;\n            this._velocities[a * 3 + 2] += pA.accelZ * deltaTime;\n\n            const mag = Math.sqrt(\n                this._velocities[a * 3 + 0] * this._velocities[a * 3 + 0] +\n                    this._velocities[a * 3 + 1] * this._velocities[a * 3 + 1] +\n                    this._velocities[a * 3 + 2] * this._velocities[a * 3 + 2]\n            );\n\n            if (mag > this.maxVelocity) {\n                this._velocities[a * 3 + 0] =\n                    (this._velocities[a * 3 + 0] / mag) * this.maxVelocity;\n                this._velocities[a * 3 + 1] =\n                    (this._velocities[a * 3 + 1] / mag) * this.maxVelocity;\n                this._velocities[a * 3 + 2] =\n                    (this._velocities[a * 3 + 2] / mag) * this.maxVelocity;\n            }\n\n            this._positions[a * 3 + 0] +=\n                deltaTime * this._velocities[a * 3 + 0];\n            this._positions[a * 3 + 1] +=\n                deltaTime * this._velocities[a * 3 + 1];\n            this._positions[a * 3 + 2] +=\n                deltaTime * this._velocities[a * 3 + 2];\n        }\n    }\n}\n","/**\n * From https://github.com/matthias-research/pages/blob/master/tenMinutePhysics/11-hashing.html\n */\n\nexport class Hash {\n    private _spacing: number;\n    private _tableSize: number;\n    private _cellStart: Int32Array;\n    private _cellEntries: Int32Array;\n    private _queryIds: Int32Array;\n    private _querySize: number;\n\n    public get querySize() {\n        return this._querySize;\n    }\n\n    public get queryIds() {\n        return this._queryIds;\n    }\n\n    constructor(spacing: number, maxNumObjects: number) {\n        this._spacing = spacing;\n        this._tableSize = 2 * maxNumObjects;\n        this._cellStart = new Int32Array(this._tableSize + 1);\n        this._cellEntries = new Int32Array(maxNumObjects);\n        this._queryIds = new Int32Array(maxNumObjects);\n        this._querySize = 0;\n    }\n\n    public hashCoords(xi: number, yi: number, zi: number) {\n        const h = (xi * 92837111) ^ (yi * 689287499) ^ (zi * 283923481); // fantasy function\n        //const h = (xi * 73856093) ^ (yi * 19349663) ^ (zi * 83492791); // fantasy function\n        return Math.abs(h) % this._tableSize;\n    }\n\n    public intCoord(coord: number) {\n        return Math.floor(coord / this._spacing);\n    }\n\n    public hashPos(pos: number[] | Float32Array, nr: number) {\n        return this.hashCoords(\n            this.intCoord(pos[3 * nr]),\n            this.intCoord(pos[3 * nr + 1]),\n            this.intCoord(pos[3 * nr + 2])\n        );\n    }\n\n    public create(pos: number[] | Float32Array, numElements?: number) {\n        numElements = numElements ?? pos.length / 3;\n\n        const numObjects = Math.min(numElements, this._cellEntries.length);\n\n        // determine cell sizes\n        this._cellStart.fill(0);\n        this._cellEntries.fill(0);\n\n        for (let i = 0; i < numObjects; i++) {\n            const h = this.hashPos(pos, i);\n            this._cellStart[h]++;\n        }\n\n        // determine cells starts\n        let start = 0;\n        for (let i = 0; i < this._tableSize; i++) {\n            start += this._cellStart[i];\n            this._cellStart[i] = start;\n        }\n        this._cellStart[this._tableSize] = start; // guard\n\n        // fill in objects ids\n        for (let i = 0; i < numObjects; i++) {\n            const h = this.hashPos(pos, i);\n            this._cellStart[h]--;\n            this._cellEntries[this._cellStart[h]] = i;\n        }\n    }\n\n    public query(pos: number[] | Float32Array, nr: number, maxDist: number) {\n        const x0 = this.intCoord(pos[3 * nr] - maxDist);\n        const y0 = this.intCoord(pos[3 * nr + 1] - maxDist);\n        const z0 = this.intCoord(pos[3 * nr + 2] - maxDist);\n\n        const x1 = this.intCoord(pos[3 * nr] + maxDist);\n        const y1 = this.intCoord(pos[3 * nr + 1] + maxDist);\n        const z1 = this.intCoord(pos[3 * nr + 2] + maxDist);\n\n        this._querySize = 0;\n\n        for (let xi = x0; xi <= x1; xi++) {\n            for (let yi = y0; yi <= y1; yi++) {\n                for (let zi = z0; zi <= z1; zi++) {\n                    const h = this.hashCoords(xi, yi, zi);\n                    const start = this._cellStart[h];\n                    const end = this._cellStart[h + 1];\n\n                    for (let i = start; i < end; i++) {\n                        this._queryIds[this._querySize] = this._cellEntries[i];\n                        this._querySize++;\n                    }\n                }\n            }\n        }\n    }\n}\n","import * as BABYLON from \"@babylonjs/core\";\n\nexport class ParticleGenerator {\n    private _scene: BABYLON.Scene;\n    private _observer: BABYLON.Nullable<BABYLON.Observer<BABYLON.Scene>>;\n    private _currNumParticles: number;\n    private _numCrossSection: number;\n    private _numParticles = 0;\n    private _positions: Float32Array;\n    private _velocities: Float32Array;\n    private _loadFromFile: string | undefined;\n\n    public particleRadius: number;\n\n    public position: BABYLON.Vector3;\n\n    public get currNumParticles() {\n        return this._currNumParticles;\n    }\n\n    public get positions() {\n        return this._positions;\n    }\n\n    public get velocities() {\n        return this._velocities;\n    }\n\n    constructor(scene: BABYLON.Scene, loadFromFile?: string) {\n        this._scene = scene;\n        this._currNumParticles = 0;\n        this._numCrossSection = 0;\n        this._positions = new Float32Array();\n        this._velocities = new Float32Array();\n        this.particleRadius = 0;\n        this._loadFromFile = loadFromFile;\n        this.position = new BABYLON.Vector3(0, 0, 0);\n\n        if (!this._loadFromFile) {\n            this._observer = scene.onBeforeRenderObservable.add(() => {\n                if (this._currNumParticles === 0) {\n                    if (this._positions.length / 3 >= this._numCrossSection) {\n                        this._currNumParticles = this._numCrossSection;\n                    }\n                } else if (this._currNumParticles < this._numParticles) {\n                    const px1 = this._positions[this._currNumParticles * 3 + 0];\n                    const py1 = this._positions[this._currNumParticles * 3 + 1];\n                    const pz1 = this._positions[this._currNumParticles * 3 + 2];\n\n                    const px2 =\n                        this._positions[\n                            (this._currNumParticles - this._numCrossSection) *\n                                3 +\n                                0\n                        ];\n                    const py2 =\n                        this._positions[\n                            (this._currNumParticles - this._numCrossSection) *\n                                3 +\n                                1\n                        ];\n                    const pz2 =\n                        this._positions[\n                            (this._currNumParticles - this._numCrossSection) *\n                                3 +\n                                2\n                        ];\n\n                    const dist = Math.sqrt(\n                        (px1 - px2) * (px1 - px2) +\n                            (py1 - py2) * (py1 - py2) +\n                            (pz1 - pz2) * (pz1 - pz2)\n                    );\n\n                    if (dist > this.particleRadius * 2) {\n                        this._currNumParticles += this._numCrossSection;\n                    }\n                }\n            });\n        } else {\n            this._observer = null;\n        }\n    }\n\n    public async generateParticles(\n        numTotParticles: number,\n        regenerateAll = true\n    ) {\n        if (this._loadFromFile) {\n            await this._generateParticlesFromFile(this._loadFromFile);\n        } else {\n            this._generateParticles(numTotParticles, regenerateAll);\n        }\n    }\n\n    private async _generateParticlesFromFile(fileName: string) {\n        const data = await (\n            await fetch(`/assets/particles/${fileName}.txt`)\n        ).text();\n\n        const lines = data.replace(\"\\r\", \"\").split(\"\\n\");\n\n        const particlePos = [];\n        const particleVel = [];\n\n        let numParticles = 0;\n\n        for (let i = 1; i < lines.length; ++i) {\n            const line = lines[i];\n            const vals = line.split(\",\");\n            if (line.charAt(0) === '\"' || vals.length < 4) {\n                continue;\n            }\n            particlePos.push(\n                parseFloat(vals[1]) + this.position.x,\n                parseFloat(vals[2]) + +this.position.y,\n                parseFloat(vals[3]) + this.position.z\n            );\n            particleVel.push(0, 0, 0);\n            numParticles++;\n        }\n\n        const particleStartIndex = 0;\n\n        this._numParticles = this._numCrossSection = numParticles;\n\n        if (this._numParticles > this._positions.length / 3) {\n            const newPositions = new Float32Array(this._numParticles * 3);\n            const newVelocities = new Float32Array(this._numParticles * 3);\n\n            newPositions.set(this._positions, 0);\n            newVelocities.set(this._velocities, 0);\n\n            this._positions = newPositions;\n            this._velocities = newVelocities;\n        }\n\n        this._positions.set(particlePos, particleStartIndex * 3);\n        this._velocities.set(particleVel, particleStartIndex * 3);\n\n        this._currNumParticles = this._numParticles;\n    }\n\n    private _generateParticles(\n        numTotParticles: number,\n        regenerateAll = true\n    ): void {\n        if (this._numParticles >= numTotParticles && !regenerateAll) {\n            this._numParticles = numTotParticles;\n            this._currNumParticles = Math.min(\n                this._currNumParticles,\n                this._numParticles\n            );\n            return;\n        }\n\n        const dimX = 12,\n            dimY = 12;\n\n        const particlePos = [];\n        const particleVel = [];\n\n        const distance = this.particleRadius * 2;\n        const jitter = distance * 0.1;\n        const getJitter = () => Math.random() * jitter - jitter / 2;\n\n        const particleStartIndex = regenerateAll ? 0 : this._currNumParticles;\n\n        this._numParticles = particleStartIndex;\n\n        while (this._numParticles <= numTotParticles - this._numCrossSection) {\n            let yCoord = (dimY / 2) * distance;\n\n            this._numCrossSection = 0;\n            for (let y = 1; y < dimY - 1; ++y) {\n                const angle = (y * Math.PI) / (dimY - 1);\n\n                let x2 = ((Math.sin(angle) * dimX) / 2) * distance;\n                if (x2 < 0) {\n                    x2 = 0;\n                }\n\n                let xCoord = -x2;\n                while (xCoord <= x2) {\n                    const xc =\n                        xCoord === -x2 || xCoord + distance > x2\n                            ? xCoord\n                            : xCoord + getJitter();\n                    const yc =\n                        xCoord === -x2 || xCoord + distance > x2\n                            ? yCoord\n                            : yCoord + getJitter();\n                    const zCoord =\n                        xCoord === -x2 || xCoord + distance > x2\n                            ? 0.49\n                            : 0.49 + getJitter();\n                    particlePos.push(\n                        xc + this.position.x,\n                        yc + this.position.y,\n                        zCoord + this.position.z\n                    );\n                    particleVel.push(\n                        (Math.random() - 0.5) * 0.03,\n                        (Math.random() - 0.5) * 0.03,\n                        (Math.random() - 1.0) * 0.03 - 1.5\n                    );\n                    xCoord += distance;\n                    this._numParticles++;\n                    this._numCrossSection++;\n                }\n\n                yCoord += distance;\n            }\n        }\n\n        if (this._numParticles > this._positions.length / 3) {\n            const newPositions = new Float32Array(this._numParticles * 3);\n            const newVelocities = new Float32Array(this._numParticles * 3);\n\n            newPositions.set(this._positions, 0);\n            newVelocities.set(this._velocities, 0);\n\n            this._positions = newPositions;\n            this._velocities = newVelocities;\n        }\n\n        this._positions.set(particlePos, particleStartIndex * 3);\n        this._velocities.set(particleVel, particleStartIndex * 3);\n\n        this._currNumParticles = particleStartIndex;\n    }\n\n    public dispose(): void {\n        this._scene.onBeforeRenderObservable.remove(this._observer);\n        this._observer = null;\n    }\n}\n","export default __webpack_public_path__ + \"1927c2ee10e174350b0f2680480bac03.png\";","export default __webpack_public_path__ + \"42501ae63687985d3bdf75e684bf30b8.png\";","export default __webpack_public_path__ + \"de78498b6fd56d907b099104d11e9a2a.png\";","export default __webpack_public_path__ + \"cb9384751f5882e7f6eb9f8d4f333114.png\";","import * as BABYLON from \"@babylonjs/core\";\n\n// Textures from https://freepbr.com/materials/sulphuric-rock/\nimport rockBaseColor from \"../../assets/materials/sulphuric-rock_albedo.png\";\nimport rockRoughness from \"../../assets/materials/sulphuric-rock_roughness.png\";\nimport rockNormal from \"../../assets/materials/sulphuric-rock_normal-ogl.png\";\n\nimport marbleBaseColor from \"../../assets/materials/Marble08_1K_BaseColor.png\";\n\nconst eps = 0.0001;\n\nconst eps1 = new BABYLON.Vector3(eps, -eps, -eps);\nconst eps2 = new BABYLON.Vector3(-eps, -eps, eps);\nconst eps3 = new BABYLON.Vector3(-eps, eps, -eps);\nconst eps4 = new BABYLON.Vector3(eps, eps, eps);\n\nconst dir1 = new BABYLON.Vector3(1, -1, -1);\nconst dir2 = new BABYLON.Vector3(-1, -1, 1);\nconst dir3 = new BABYLON.Vector3(-1, 1, -1);\nconst dir4 = new BABYLON.Vector3(1, 1, 1);\n\nexport interface SDFArray {\n    origin: BABYLON.Vector3;\n    dimX: number;\n    dimY: number;\n    dimZ: number;\n    step: number;\n    data: number[];\n}\n\nexport interface ICollisionShape {\n    params: Array<any>;\n    sdEvaluate: (p: BABYLON.Vector3, ...args: any[]) => number;\n    computeNormal: (\n        pos: BABYLON.Vector3,\n        shape: ICollisionShape,\n        normal: BABYLON.Vector3\n    ) => void;\n    createMesh?: (\n        scene: BABYLON.Scene,\n        shape: ICollisionShape,\n        ...args: any[]\n    ) => Promise<BABYLON.Mesh>;\n    transf: BABYLON.Matrix;\n    invTransf: BABYLON.Matrix;\n    scale: number;\n    position?: BABYLON.Vector3;\n    rotation?: BABYLON.Vector3;\n    rotationQuaternion?: BABYLON.Quaternion;\n    mesh?: BABYLON.Mesh;\n    dragPlane: BABYLON.Nullable<BABYLON.Vector3>;\n    disabled?: boolean;\n    collisionRestitution?: number;\n}\n\nexport class SDFHelper {\n    public static CreateBox(\n        scene: BABYLON.Scene,\n        shape: ICollisionShape,\n        extents: BABYLON.Vector3\n    ) {\n        const box = BABYLON.MeshBuilder.CreateBox(\n            \"box\",\n            {\n                width: extents.x * 2,\n                height: extents.y * 2,\n                depth: extents.z * 2,\n            },\n            scene\n        );\n\n        const material = new BABYLON.PBRMaterial(\"boxMat\", scene);\n\n        material.metallic = 0;\n        material.roughness = 0.9;\n        material.albedoTexture = new BABYLON.Texture(\n            \"https://playground.babylonjs.com/textures/wood.jpg\",\n            scene\n        );\n        material.cullBackFaces = true;\n\n        box.material = material;\n\n        return Promise.resolve(box);\n    }\n\n    public static CreateSphere(\n        scene: BABYLON.Scene,\n        shape: ICollisionShape,\n        s: number\n    ) {\n        const sphere = BABYLON.MeshBuilder.CreateSphere(\n            \"sphere\",\n            { diameter: s * 2, segments: 16 },\n            scene\n        );\n\n        const material = new BABYLON.PBRMaterial(\"sphereMat\", scene);\n\n        material.metallic = 1;\n        material.roughness = 0.05;\n        material.albedoTexture = new BABYLON.Texture(marbleBaseColor, scene);\n        material.cullBackFaces = true;\n\n        sphere.material = material;\n\n        return Promise.resolve(sphere);\n    }\n\n    public static CreateCutHollowSphere(\n        scene: BABYLON.Scene,\n        shape: ICollisionShape,\n        radius: number,\n        planeDist: number,\n        thickness: number,\n        segments: number\n    ) {\n        thickness = thickness / radius;\n\n        const sphere = BABYLON.MeshBuilder.CreateSphere(\n            \"sphere\",\n            { diameter: radius * 2, segments },\n            scene\n        );\n        const plane = BABYLON.MeshBuilder.CreatePlane(\n            \"plane\",\n            { size: radius * 2 },\n            scene\n        );\n\n        plane.rotation.y = Math.PI / 2;\n        plane.position.x = planeDist;\n\n        const csg1 = BABYLON.CSG.FromMesh(sphere);\n        const csgp = BABYLON.CSG.FromMesh(plane);\n\n        sphere.dispose();\n        plane.dispose();\n\n        csg1.subtractInPlace(csgp);\n\n        const mesh = csg1.toMesh(\"sppl\");\n\n        mesh.computeWorldMatrix(true);\n        mesh.refreshBoundingInfo();\n\n        mesh.scaling.setAll(1 - thickness);\n        mesh.position.x =\n            mesh.getBoundingInfo().boundingBox.maximumWorld.x * thickness;\n\n        const csg2 = BABYLON.CSG.FromMesh(mesh);\n\n        mesh.dispose();\n\n        csg1.subtractInPlace(csg2);\n\n        const meshFinal = csg1.toMesh(\"cutHollowSphere\");\n\n        meshFinal.rotation.z = Math.PI / 2;\n        meshFinal.bakeCurrentTransformIntoVertices();\n\n        const material = new BABYLON.PBRMaterial(\"cutHollowSphereMat\", scene);\n\n        material.metallic = 1;\n        material.roughness = 0.05;\n        material.albedoTexture = new BABYLON.Texture(marbleBaseColor, scene);\n        material.cullBackFaces = true;\n\n        meshFinal.material = material;\n\n        return Promise.resolve(meshFinal);\n    }\n\n    public static CreateVerticalCylinder(\n        scene: BABYLON.Scene,\n        shape: ICollisionShape,\n        r: number,\n        h: number,\n        segments: number\n    ) {\n        const cylinder = BABYLON.MeshBuilder.CreateCylinder(\n            \"cylinder\",\n            { diameter: r * 2, height: h, tessellation: segments },\n            scene\n        );\n\n        const material = new BABYLON.PBRMaterial(\"cylinderMat\", scene);\n\n        material.metallic = 1;\n        material.roughness = 0.05;\n        material.albedoTexture = new BABYLON.Texture(marbleBaseColor, scene);\n        material.cullBackFaces = true;\n\n        cylinder.material = material;\n\n        return Promise.resolve(cylinder);\n    }\n\n    public static CreateTerrain(\n        scene: BABYLON.Scene,\n        shape: ICollisionShape,\n        size: number\n    ) {\n        const ground = BABYLON.MeshBuilder.CreateGroundFromHeightMap(\n            \"terrain\",\n            \"https://playground.babylonjs.com/textures/heightMap.png\",\n            {\n                width: size,\n                height: size,\n                subdivisions: 128,\n                maxHeight: size / 5,\n                onReady: () => ground!.updateCoordinateHeights(),\n            },\n            scene\n        );\n\n        const mat = new BABYLON.PBRMaterial(\"mat\", scene);\n\n        mat.metallicTexture = new BABYLON.Texture(rockRoughness, scene);\n        mat.albedoTexture = new BABYLON.Texture(rockBaseColor, scene);\n        mat.bumpTexture = new BABYLON.Texture(rockNormal, scene);\n        mat.useRoughnessFromMetallicTextureGreen = true;\n        mat.metallic = 0;\n        mat.roughness = 1;\n\n        ground.material = mat;\n\n        shape.params.push(ground);\n\n        return Promise.resolve(ground);\n    }\n\n    protected static _ParseSDFData(textData: string): SDFArray {\n        const lines = textData.replace(\"\\r\", \"\").split(\"\\n\");\n\n        const dimLine = lines[0].split(\" \");\n\n        const dimX = parseFloat(dimLine[0]);\n        const dimY = parseFloat(dimLine[1]);\n        const dimZ = parseFloat(dimLine[2]);\n\n        const originLine = lines[1].split(\" \");\n\n        const origin = new BABYLON.Vector3(\n            parseFloat(originLine[0]),\n            parseFloat(originLine[1]),\n            parseFloat(originLine[2])\n        );\n\n        const step = parseFloat(lines[2]);\n\n        const data: number[] = [];\n\n        for (let i = 3; i < lines.length; ++i) {\n            const val = lines[i];\n            if (val.length === 0) {\n                continue;\n            }\n            data.push(parseFloat(val));\n        }\n\n        return {\n            dimX,\n            dimY,\n            dimZ,\n            origin,\n            step,\n            data,\n        };\n    }\n\n    public static CreateMesh(\n        scene: BABYLON.Scene,\n        shape: ICollisionShape,\n        meshFilename: string,\n        sdfFilename: string,\n        createNormals: boolean\n    ): Promise<BABYLON.Mesh> {\n        return new Promise((resolve) => {\n            const promises = [\n                BABYLON.SceneLoader.ImportMeshAsync(\n                    \"\",\n                    \"/assets/scenes/\",\n                    meshFilename,\n                    scene\n                ),\n                new Promise((resolve) => {\n                    fetch(\"/assets/sdf/\" + sdfFilename).then((response) => {\n                        response.text().then((text) => {\n                            shape.params.push(SDFHelper._ParseSDFData(text));\n                            resolve(void 0);\n                        });\n                    });\n                }),\n            ];\n\n            Promise.all(promises).then((results) => {\n                const meshes = results[0] as BABYLON.ISceneLoaderAsyncResult;\n                const mesh = meshes.meshes[0] as BABYLON.Mesh;\n                if (!mesh.material) {\n                    const material = new BABYLON.PBRMaterial(\"meshMat\", scene);\n\n                    material.metallic = 1;\n                    material.roughness = 0.05;\n                    material.albedoTexture = new BABYLON.Texture(\n                        rockBaseColor,\n                        scene\n                    );\n                    material.cullBackFaces = true;\n\n                    mesh.material = material;\n                }\n                if (createNormals) {\n                    mesh.createNormals(false);\n                }\n                mesh.scaling.setAll(shape.scale);\n                resolve(mesh);\n            });\n        });\n    }\n\n    // SD functions from https://iquilezles.org/articles/distfunctions/\n    public static SDBox(p: BABYLON.Vector3, b: BABYLON.Vector3) {\n        const q = BABYLON.TmpVectors.Vector3[0];\n        q.copyFromFloats(Math.abs(p.x), Math.abs(p.y), Math.abs(p.z));\n        q.subtractInPlace(b);\n\n        const tmp = Math.min(Math.max(q.x, q.y, q.z), 0);\n\n        q.maximizeInPlaceFromFloats(0, 0, 0);\n\n        return q.length() + tmp;\n    }\n\n    public static SDSphere(p: BABYLON.Vector3, s: number) {\n        return p.length() - s;\n    }\n\n    public static SDPlane(p: BABYLON.Vector3, n: BABYLON.Vector3, h: number) {\n        return BABYLON.Vector3.Dot(p, n) + h;\n    }\n\n    public static SDCutHollowSphere(\n        p: BABYLON.Vector3,\n        r: number,\n        h: number,\n        t: number\n    ) {\n        // sampling independent computations (only depend on shape)\n        const w = Math.sqrt(r * r - h * h);\n\n        // sampling dependant computations\n        const qx = Math.sqrt(p.x * p.x + p.z * p.z);\n        const qy = p.y;\n\n        if (h * qx < w * qy) {\n            return Math.sqrt((qx - w) * (qx - w) + (qy - h) * (qy - h));\n        }\n\n        return Math.abs(Math.sqrt(qx * qx + qy * qy) - r) - t;\n    }\n\n    public static SDVerticalCylinder(p: BABYLON.Vector3, r: number, h: number) {\n        const dx = Math.abs(Math.sqrt(p.x * p.x + p.z * p.z)) - r;\n        const dy = Math.abs(p.y) - h;\n        const dx2 = Math.max(dx, 0);\n        const dy2 = Math.max(dy, 0);\n\n        return (\n            Math.min(Math.max(dx, dy), 0.0) + Math.sqrt(dx2 * dx2 + dy2 * dy2)\n        );\n    }\n\n    public static SDTerrain(\n        p: BABYLON.Vector3,\n        size: number,\n        terrain: BABYLON.GroundMesh\n    ) {\n        return p.y - terrain.getHeightAtCoordinates(p.x, p.z);\n    }\n\n    public static SDMesh(\n        p: BABYLON.Vector3,\n        meshFilename: string,\n        sdfFilename: string,\n        createNormals: boolean,\n        sdf: SDFArray\n    ) {\n        const x = (p.x - sdf.origin.x) / sdf.step;\n        const y = (p.y - sdf.origin.y) / sdf.step;\n        const z = (p.z - sdf.origin.z) / sdf.step;\n\n        let gx = Math.floor(x);\n        let gy = Math.floor(y);\n        let gz = Math.floor(z);\n\n        gx = Math.max(Math.min(gx, sdf.dimX - 2), 0);\n        gy = Math.max(Math.min(gy, sdf.dimY - 2), 0);\n        gz = Math.max(Math.min(gz, sdf.dimZ - 2), 0);\n\n        // trilinear filtering\n        const fx = x - gx;\n        const fy = y - gy;\n        const fz = z - gz;\n\n        const a00 = sdf.data[gz * sdf.dimY * sdf.dimX + gy * sdf.dimX + gx];\n        const a10 = sdf.data[gz * sdf.dimY * sdf.dimX + gy * sdf.dimX + gx + 1];\n        const a11 =\n            sdf.data[gz * sdf.dimY * sdf.dimX + (gy + 1) * sdf.dimX + gx + 1];\n        const a01 =\n            sdf.data[gz * sdf.dimY * sdf.dimX + (gy + 1) * sdf.dimX + gx];\n\n        const a0 = a00 * (1 - fx) + a10 * fx;\n        const a1 = a01 * (1 - fx) + a11 * fx;\n        const a = a0 * (1 - fy) + a1 * fy;\n\n        const b00 =\n            sdf.data[(gz + 1) * sdf.dimY * sdf.dimX + gy * sdf.dimX + gx];\n        const b10 =\n            sdf.data[(gz + 1) * sdf.dimY * sdf.dimX + gy * sdf.dimX + gx + 1];\n        const b11 =\n            sdf.data[\n                (gz + 1) * sdf.dimY * sdf.dimX + (gy + 1) * sdf.dimX + gx + 1\n            ];\n        const b01 =\n            sdf.data[(gz + 1) * sdf.dimY * sdf.dimX + (gy + 1) * sdf.dimX + gx];\n\n        const b0 = b00 * (1 - fx) + b10 * fx;\n        const b1 = b01 * (1 - fx) + b11 * fx;\n        const b = b0 * (1 - fy) + b1 * fy;\n\n        const d = a * (1 - fz) + b * fz;\n        //const d = sdf.data[gz * sdf.dimY * sdf.dimX + gy * sdf.dimX + gx];\n\n        return d;\n    }\n\n    // normal computed with the Tetrahedron technique, see https://iquilezles.org/articles/normalsSDF/\n    public static ComputeSDFNormal(\n        pos: BABYLON.Vector3,\n        shape: ICollisionShape,\n        normal: BABYLON.Vector3\n    ) {\n        const posTemp = BABYLON.TmpVectors.Vector3[5];\n        const dir = BABYLON.TmpVectors.Vector3[6];\n\n        normal.copyFromFloats(0, 0, 0);\n\n        posTemp.copyFrom(pos);\n        dir.copyFrom(dir1);\n        normal.addInPlace(\n            dir.scaleInPlace(\n                shape.sdEvaluate(posTemp.addInPlace(eps1), ...shape.params)\n            )\n        );\n\n        posTemp.copyFrom(pos);\n        dir.copyFrom(dir2);\n        normal.addInPlace(\n            dir.scaleInPlace(\n                shape.sdEvaluate(posTemp.addInPlace(eps2), ...shape.params)\n            )\n        );\n\n        posTemp.copyFrom(pos);\n        dir.copyFrom(dir3);\n        normal.addInPlace(\n            dir.scaleInPlace(\n                shape.sdEvaluate(posTemp.addInPlace(eps3), ...shape.params)\n            )\n        );\n\n        posTemp.copyFrom(pos);\n        dir.copyFrom(dir4);\n        normal.addInPlace(\n            dir.scaleInPlace(\n                shape.sdEvaluate(posTemp.addInPlace(eps4), ...shape.params)\n            )\n        );\n\n        BABYLON.Vector3.TransformNormalToRef(normal, shape.transf, normal);\n\n        normal.normalize();\n    }\n\n    public static ComputeTerrainNormal(\n        pos: BABYLON.Vector3,\n        shape: ICollisionShape,\n        normal: BABYLON.Vector3\n    ) {\n        const terrain = shape.params[1] as BABYLON.GroundMesh;\n\n        terrain.getNormalAtCoordinatesToRef(pos.x, pos.z, normal);\n    }\n}\n","import * as BABYLON from \"@babylonjs/core\";\n\nimport * as LiLGUI from \"lil-gui\";\n\nimport {\n    FluidRenderer,\n    IFluidRenderingRenderObject,\n} from \"./FluidRenderer/fluidRenderer\";\nimport { FluidRendererGUI } from \"./FluidRenderer/fluidRendererGUI\";\nimport { FluidRenderingObjectVertexBuffer } from \"./FluidRenderer/fluidRenderingObjectVertexBuffer\";\nimport { FluidSimulator } from \"./FluidSimulator2/fluidSimulator\";\nimport { ParticleGenerator } from \"./Utils/particleGenerator\";\nimport { ICollisionShape, SDFHelper } from \"./Utils/sdfHelper\";\nimport {debugMenuToggle} from \"../index\";\n\nconst envNames = [\n    \"Environment\",\n    \"Country\",\n    \"Parking\",\n    \"Night\",\n    \"Canyon\",\n    \"Studio\",\n];\nconst envFile = [\n    \"environment.env\",\n    \"country.env\",\n    \"parking.env\",\n    \"night.env\",\n    \"Runyon_Canyon_A_2k_cube_specular.env\",\n    \"Studio_Softbox_2Umbrellas_cube_specular.env\",\n];\n\nexport class FluidSimulationDemoBase {\n    protected _scene: BABYLON.Scene;\n    protected _engine: BABYLON.Engine;\n    protected _gui: BABYLON.Nullable<LiLGUI.GUI>;\n    protected _environmentFile: string;\n    protected _noFluidSimulation: boolean;\n\n    protected _fluidRenderer: FluidRenderer;\n    protected _fluidRenderObject: IFluidRenderingRenderObject;\n    protected _fluidRendererGUI: BABYLON.Nullable<FluidRendererGUI>;\n    protected _fluidSim: BABYLON.Nullable<FluidSimulator>;\n    protected _particleGenerator: BABYLON.Nullable<ParticleGenerator>;\n    protected _numParticles: number;\n    protected _paused: boolean;\n    protected _sceneObserver: BABYLON.Nullable<BABYLON.Observer<BABYLON.Scene>>;\n    protected _loadParticlesFromFile: boolean;\n    protected _shapeCollisionRestitution: number;\n    protected _collisionObjectPromises: Array<\n        Promise<[BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]>\n    >;\n    protected _collisionObjects: Array<\n        [BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]\n    >;\n\n    protected _fluidSimGUIElements: Array<[LiLGUI.Controller, any, string]>;\n\n    protected static _DemoList: Array<{\n        name: string;\n        factory: () => FluidSimulationDemoBase;\n    }> = [];\n    protected static _CurrentDemo: FluidSimulationDemoBase;\n    protected static _CurrentDemoIndex: number;\n\n    public static AddDemo(\n        name: string,\n        factory: () => FluidSimulationDemoBase\n    ): void {\n        FluidSimulationDemoBase._DemoList.push({ name, factory });\n    }\n\n    public static StartDemo(index: number): void {\n        FluidSimulationDemoBase._CurrentDemo?.dispose();\n        FluidSimulationDemoBase._CurrentDemoIndex = index;\n        FluidSimulationDemoBase._CurrentDemo =\n            FluidSimulationDemoBase._DemoList[index].factory();\n        FluidSimulationDemoBase._CurrentDemo.run();\n    }\n\n    constructor(\n        scene: BABYLON.Scene,\n        noFluidSimulation = false,\n        particleFileName?: string\n    ) {\n        this._scene = scene;\n        this._engine = scene.getEngine();\n        this._fluidRenderer = scene.enableFluidRenderer()!;\n        this._numParticles = 1700;\n        this._paused = false;\n        this._gui = null;\n        this._fluidRendererGUI = null;\n        this._sceneObserver = null;\n        this._fluidSim = null;\n        this._particleGenerator = null;\n        this._loadParticlesFromFile = particleFileName !== undefined;\n        this._shapeCollisionRestitution = 0.999;\n        this._collisionObjectPromises = [];\n        this._collisionObjects = [];\n        this._environmentFile = \"Environment\";\n        this._fluidSimGUIElements = [];\n        this._noFluidSimulation = noFluidSimulation;\n\n        const particleRadius = 0.02;\n        const camera = scene.activeCameras?.[0] ?? scene.activeCamera!;\n\n        camera.storeState();\n\n        // Setup the fluid renderer object\n        const vertexBuffers: { [name: string]: BABYLON.VertexBuffer } = {};\n\n        this._fluidRenderObject = this._fluidRenderer.addVertexBuffer(\n            vertexBuffers,\n            0,\n            false,\n            undefined,\n            camera\n        );\n\n        this._fluidRenderObject.targetRenderer.enableBlurDepth = true;\n        this._fluidRenderObject.targetRenderer.blurDepthFilterSize = 20;\n        this._fluidRenderObject.targetRenderer.blurDepthNumIterations = 10;\n        this._fluidRenderObject.targetRenderer.blurDepthDepthScale = 100;\n        this._fluidRenderObject.targetRenderer.fluidColor = new BABYLON.Color3(\n            0,\n            251 / 255,\n            255 / 255\n        );\n        this._fluidRenderObject.targetRenderer.density = 10;\n        this._fluidRenderObject.targetRenderer.refractionStrength = 0.0;\n        this._fluidRenderObject.targetRenderer.specularPower = 2600;\n        this._fluidRenderObject.targetRenderer.blurThicknessFilterSize = 6;\n        this._fluidRenderObject.targetRenderer.blurThicknessNumIterations = 5;\n        this._fluidRenderObject.targetRenderer.dirLight = new BABYLON.Vector3(\n            2,\n            -1,\n            1\n        );\n        this._fluidRenderObject.object.particleSize = particleRadius * 2 * 2;\n        this._fluidRenderObject.object.particleThicknessAlpha =\n            this._fluidRenderObject.object.particleSize;\n        this._fluidRenderObject.object.useVelocity =\n            this._fluidRenderObject.targetRenderer.useVelocity;\n        this._fluidRenderObject.targetRenderer.minimumThickness =\n            this._fluidRenderObject.object.particleThicknessAlpha / 2;\n\n        // Setup the fluid simulator / particle generator\n        if (!noFluidSimulation) {\n            this._fluidSim = new FluidSimulator();\n\n            this._fluidSim.smoothingRadius = particleRadius * 2;\n            this._fluidSim.maxVelocity = 3;\n\n            (window as any).fsim = this._fluidSim;\n\n            this._particleGenerator = new ParticleGenerator(\n                this._scene,\n                particleFileName\n            );\n            this._particleGenerator.particleRadius =\n                this._fluidSim.smoothingRadius / 2;\n            this._particleGenerator.position.y = 0.5;\n        }\n    }\n\n    protected _setEnvironment() {\n        // const idx = envNames.indexOf(this._environmentFile);\n        // this._scene.environmentTexture =\n        //     BABYLON.CubeTexture.CreateFromPrefilteredData(\n        //         \"https://playground.babylonjs.com/textures/\" + envFile[idx],\n        //         this._scene\n        //     );\n        // this._scene.createDefaultSkybox(this._scene.environmentTexture);\n        // this._scene.getMeshById(\"hdrSkyBox\")?.setEnabled(false);\n        const hdrTexture = BABYLON.CubeTexture.CreateFromPrefilteredData(\n            \"./envFiles/light.dds\",\n            this._scene\n        );\n        this._scene.createDefaultSkybox(hdrTexture, true);\n        this._scene.getMeshById(\"hdrSkyBox\")?.setEnabled(false);\n        this._scene.environmentIntensity = 1.287;\n        this._scene.clearColor = new BABYLON.Color4(0, 0, 0, 0.0)\n    }\n\n    public async run() {\n        this._setEnvironment();\n\n        this._collisionObjects = await Promise.all(\n            this._collisionObjectPromises\n        );\n\n        this._run();\n    }\n\n    protected async _run() {\n        await this._generateParticles();\n\n        if (this._particleGenerator && this._loadParticlesFromFile) {\n            this._numParticles = this._particleGenerator.currNumParticles;\n        }\n\n        this._fluidRendererGUI = new FluidRendererGUI(this._scene, false);\n\n        this._makeGUI();\n\n        if (!this._noFluidSimulation) {\n            this._sceneObserver = this._scene.onBeforeRenderObservable.add(\n                () => {\n                    this._fluidSim!.currentNumParticles = Math.min(\n                        this._numParticles,\n                        this._particleGenerator!.currNumParticles\n                    );\n                    (\n                        this._fluidRenderObject\n                            .object as FluidRenderingObjectVertexBuffer\n                    ).setNumParticles(this._fluidSim!.currentNumParticles);\n\n                    if (!this._paused) {\n                        this._fluidSim!.update(1 / 100);\n                        this._checkCollisions(\n                            this._fluidRenderObject.object.particleSize / 2\n                        );\n                    }\n\n                    if (\n                        this._fluidRenderObject &&\n                        this._fluidRenderObject.object.vertexBuffers[\"position\"]\n                    ) {\n                        this._fluidRenderObject.object.vertexBuffers[\n                            \"position\"\n                        ].updateDirectly(this._fluidSim!.positions, 0);\n                        this._fluidRenderObject.object.vertexBuffers[\n                            \"velocity\"\n                        ].updateDirectly(this._fluidSim!.velocities, 0);\n                    }\n                }\n            );\n        }\n    }\n\n    public disposeCollisionObject(index: number): void {\n        const shape = this._collisionObjects[index][1];\n\n        shape?.mesh?.material?.dispose();\n        shape?.mesh?.dispose();\n\n        this._collisionObjects.splice(index, 1);\n        this._collisionObjectPromises.splice(index, 1);\n    }\n\n    public dispose(): void {\n        while (this._collisionObjects.length > 0) {\n            this.disposeCollisionObject(0);\n        }\n\n        this._scene.onBeforeRenderObservable.remove(this._sceneObserver);\n        this._fluidRendererGUI?.dispose();\n        this._gui?.destroy();\n        this._fluidSim?.dispose();\n        this._particleGenerator?.dispose();\n        this._fluidRenderer.removeRenderObject(this._fluidRenderObject);\n\n        const camera =\n            this._scene.activeCameras?.[0] ?? this._scene.activeCamera!;\n\n        (camera as BABYLON.ArcRotateCamera)._restoreStateValues();\n    }\n\n    public addCollisionSphere(\n        position: BABYLON.Vector3,\n        radius: number,\n        dragPlane: BABYLON.Nullable<BABYLON.Vector3> = new BABYLON.Vector3(\n            0,\n            1,\n            0\n        ),\n        collisionRestitution?: number,\n        dontCreateMesh?: boolean\n    ): Promise<[BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]> {\n        const collisionShape = {\n            params: [radius],\n            createMesh: SDFHelper.CreateSphere,\n            sdEvaluate: SDFHelper.SDSphere,\n            computeNormal: SDFHelper.ComputeSDFNormal,\n            position: position.clone(),\n            mesh: null as any,\n            transf: new BABYLON.Matrix(),\n            scale: 1,\n            invTransf: new BABYLON.Matrix(),\n            dragPlane,\n            collisionRestitution,\n        };\n\n        const promise: Promise<\n            [BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]\n        > = dontCreateMesh\n            ? Promise.resolve([null, collisionShape])\n            : this._createMeshForCollision(collisionShape);\n\n        this._collisionObjectPromises.push(promise);\n\n        return promise;\n    }\n\n    public addCollisionBox(\n        position: BABYLON.Vector3,\n        rotation: BABYLON.Vector3,\n        extents: BABYLON.Vector3,\n        dragPlane: BABYLON.Nullable<BABYLON.Vector3> = new BABYLON.Vector3(\n            0,\n            1,\n            0\n        ),\n        collisionRestitution?: number,\n        dontCreateMesh?: boolean\n    ): Promise<[BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]> {\n        const collisionShape = {\n            params: [extents.clone()],\n            createMesh: SDFHelper.CreateBox,\n            sdEvaluate: SDFHelper.SDBox,\n            computeNormal: SDFHelper.ComputeSDFNormal,\n            rotation: rotation.clone(),\n            position: position.clone(),\n            mesh: null as any,\n            transf: new BABYLON.Matrix(),\n            scale: 1,\n            invTransf: new BABYLON.Matrix(),\n            dragPlane,\n            collisionRestitution,\n        };\n\n        const promise: Promise<\n            [BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]\n        > = dontCreateMesh\n            ? Promise.resolve([null, collisionShape])\n            : this._createMeshForCollision(collisionShape);\n\n        this._collisionObjectPromises.push(promise);\n\n        return promise;\n    }\n\n    public addCollisionPlane(\n        normal: BABYLON.Vector3,\n        d: number,\n        collisionRestitution?: number\n    ): Promise<[BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]> {\n        const collisionShape = {\n            params: [normal.clone(), d],\n            sdEvaluate: SDFHelper.SDPlane,\n            computeNormal: SDFHelper.ComputeSDFNormal,\n            mesh: null as any,\n            position: new BABYLON.Vector3(0, 0, 0),\n            rotation: new BABYLON.Vector3(0, 0, 0),\n            transf: BABYLON.Matrix.Identity(),\n            scale: 1,\n            invTransf: BABYLON.Matrix.Identity(),\n            dragPlane: null,\n            collisionRestitution,\n        };\n\n        const promise: Promise<\n            [BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]\n        > = Promise.resolve([null, collisionShape]);\n\n        this._collisionObjectPromises.push(promise);\n\n        return promise;\n    }\n\n    public addCollisionCutHollowSphere(\n        position: BABYLON.Vector3,\n        rotation: BABYLON.Vector3,\n        radius: number,\n        planeDist: number,\n        thickness: number,\n        segments: number,\n        dragPlane: BABYLON.Nullable<BABYLON.Vector3> = new BABYLON.Vector3(\n            0,\n            1,\n            0\n        ),\n        collisionRestitution?: number,\n        dontCreateMesh?: boolean\n    ): Promise<[BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]> {\n        const collisionShape = {\n            params: [radius, planeDist, thickness, segments],\n            createMesh: SDFHelper.CreateCutHollowSphere,\n            sdEvaluate: SDFHelper.SDCutHollowSphere,\n            computeNormal: SDFHelper.ComputeSDFNormal,\n            rotation: rotation.clone(),\n            position: position.clone(),\n            mesh: null as any,\n            transf: new BABYLON.Matrix(),\n            scale: 1,\n            invTransf: new BABYLON.Matrix(),\n            dragPlane,\n            collisionRestitution,\n        };\n\n        const promise: Promise<\n            [BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]\n        > = dontCreateMesh\n            ? Promise.resolve([null, collisionShape])\n            : this._createMeshForCollision(collisionShape);\n\n        this._collisionObjectPromises.push(promise);\n\n        return promise;\n    }\n\n    public addCollisionVerticalCylinder(\n        position: BABYLON.Vector3,\n        rotation: BABYLON.Vector3,\n        radius: number,\n        height: number,\n        segments: number,\n        dragPlane: BABYLON.Nullable<BABYLON.Vector3> = new BABYLON.Vector3(\n            0,\n            1,\n            0\n        ),\n        collisionRestitution?: number,\n        dontCreateMesh?: boolean\n    ): Promise<[BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]> {\n        const collisionShape = {\n            params: [radius, height, segments],\n            createMesh: SDFHelper.CreateVerticalCylinder,\n            sdEvaluate: SDFHelper.SDVerticalCylinder,\n            computeNormal: SDFHelper.ComputeSDFNormal,\n            rotation: rotation.clone(),\n            position: position.clone(),\n            mesh: null as any,\n            transf: new BABYLON.Matrix(),\n            scale: 1,\n            invTransf: new BABYLON.Matrix(),\n            dragPlane,\n            collisionRestitution,\n        };\n\n        const promise: Promise<\n            [BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]\n        > = dontCreateMesh\n            ? Promise.resolve([null, collisionShape])\n            : this._createMeshForCollision(collisionShape);\n\n        this._collisionObjectPromises.push(promise);\n\n        return promise;\n    }\n\n    public addCollisionMesh(\n        position: BABYLON.Vector3,\n        rotation: BABYLON.Vector3,\n        meshFilename: string,\n        sdfFilename: string,\n        createNormals = false,\n        scale = 1,\n        dragPlane: BABYLON.Nullable<BABYLON.Vector3> = new BABYLON.Vector3(\n            0,\n            1,\n            0\n        ),\n        collisionRestitution?: number,\n        dontCreateMesh?: boolean\n    ): Promise<[BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]> {\n        const collisionShape = {\n            params: [meshFilename, sdfFilename, createNormals],\n            createMesh: SDFHelper.CreateMesh,\n            sdEvaluate: SDFHelper.SDMesh,\n            computeNormal: SDFHelper.ComputeSDFNormal,\n            rotation: rotation.clone(),\n            position: position.clone(),\n            mesh: null as any,\n            transf: new BABYLON.Matrix(),\n            scale,\n            invTransf: new BABYLON.Matrix(),\n            dragPlane,\n            collisionRestitution,\n        };\n\n        const promise: Promise<\n            [BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]\n        > = dontCreateMesh\n            ? Promise.resolve([null, collisionShape])\n            : this._createMeshForCollision(collisionShape);\n\n        this._collisionObjectPromises.push(promise);\n\n        return promise;\n    }\n\n    public addCollisionTerrain(\n        size: number\n    ): Promise<[BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]> {\n        const collisionShape = {\n            params: [size],\n            createMesh: SDFHelper.CreateTerrain,\n            sdEvaluate: SDFHelper.SDTerrain,\n            computeNormal: SDFHelper.ComputeTerrainNormal,\n            mesh: null as any,\n            transf: new BABYLON.Matrix(),\n            scale: 1,\n            invTransf: new BABYLON.Matrix(),\n            dragPlane: null,\n        };\n\n        const promise: Promise<\n            [BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]\n        > = this._createMeshForCollision(collisionShape);\n\n        this._collisionObjectPromises.push(promise);\n\n        return promise;\n    }\n\n    protected async _createMeshForCollision(\n        shape: ICollisionShape\n    ): Promise<[BABYLON.Nullable<BABYLON.Mesh>, ICollisionShape]> {\n        const mesh = await shape.createMesh?.(\n            this._scene,\n            shape,\n            ...shape.params\n        );\n\n        shape.position = shape.position ?? new BABYLON.Vector3(0, 0, 0);\n        if (!shape.rotation && !shape.rotationQuaternion) {\n            shape.rotation = new BABYLON.Vector3(0, 0, 0);\n        }\n\n        if (!mesh) {\n            return [null, shape];\n        }\n\n        mesh.position = shape.position;\n        if (shape.rotation) {\n            mesh.rotation = shape.rotation;\n        } else {\n            mesh.rotationQuaternion = shape.rotationQuaternion!;\n        }\n\n        shape.mesh = mesh;\n\n        if (shape.dragPlane) {\n            // const camera =\n            //     this._scene.activeCameras?.[0] ?? this._scene.activeCamera!;\n            //\n            // const pointerDragBehavior = new BABYLON.PointerDragBehavior({\n            //     dragPlaneNormal: shape.dragPlane,\n            // });\n            // pointerDragBehavior.useObjectOrientationForDragging = false;\n            //\n            // pointerDragBehavior.onDragStartObservable.add(() => {\n            //     camera.detachControl();\n            // });\n            //\n            // pointerDragBehavior.onDragEndObservable.add(() => {\n            //     camera.attachControl();\n            // });\n            //\n            // mesh.addBehavior(pointerDragBehavior);\n        }\n\n        return [mesh, shape];\n    }\n\n    protected async _generateParticles(regenerateAll = true) {\n        await this._particleGenerator?.generateParticles(\n            this._numParticles,\n            regenerateAll\n        );\n\n        if (\n            this._fluidSim &&\n            this._particleGenerator &&\n            this._fluidSim.positions !== this._particleGenerator.positions\n        ) {\n            this._fluidSim.setParticleData(\n                this._particleGenerator.positions,\n                this._particleGenerator.velocities\n            );\n\n            this._fluidRenderObject.object.vertexBuffers[\"position\"]?.dispose();\n            this._fluidRenderObject.object.vertexBuffers[\"velocity\"]?.dispose();\n\n            this._fluidRenderObject.object.vertexBuffers[\"position\"] =\n                new BABYLON.VertexBuffer(\n                    this._engine,\n                    this._fluidSim.positions,\n                    BABYLON.VertexBuffer.PositionKind,\n                    true,\n                    false,\n                    3,\n                    true\n                );\n            this._fluidRenderObject.object.vertexBuffers[\"velocity\"] =\n                new BABYLON.VertexBuffer(\n                    this._engine,\n                    this._fluidSim.velocities,\n                    \"velocity\",\n                    true,\n                    false,\n                    3,\n                    true\n                );\n        }\n    }\n\n    protected _makeGUIMainMenu(): void {\n        // empty\n    }\n\n    protected _syncFluidSimGUI(): void {\n        for (const [elem, obj, property] of this._fluidSimGUIElements) {\n            (elem.object as any)[elem.property] = obj[property];\n            elem.updateDisplay();\n        }\n    }\n\n    protected _makeGUI(): void {\n        if (debugMenuToggle) {\n            this._gui = new LiLGUI.GUI({ title: \"Demo\" });\n            this._gui.domElement.style.marginTop = \"60px\";\n            this._gui.domElement.style.left = \"20px\";\n            this._gui.domElement.id = \"simGUI\";\n\n            const params = {\n                demo: FluidSimulationDemoBase._DemoList[\n                    FluidSimulationDemoBase._CurrentDemoIndex\n                    ].name,\n                environment: this._environmentFile,\n                paused: false,\n                numParticles: this._numParticles,\n                smoothingRadius: this._fluidSim?.smoothingRadius,\n                densityReference: this._fluidSim?.densityReference,\n                pressureConstant: this._fluidSim?.pressureConstant,\n                viscosity: this._fluidSim?.viscosity,\n                minTimeStep: this._fluidSim?.minTimeStep,\n                maxVelocity: this._fluidSim?.maxVelocity,\n                maxAcceleration: this._fluidSim?.maxAcceleration,\n                shapeCollisionRestitution: this._shapeCollisionRestitution,\n            };\n\n            const demoList: string[] = [];\n            for (const demo of FluidSimulationDemoBase._DemoList) {\n                demoList.push(demo.name);\n            }\n\n            this._gui\n                .add(params, \"demo\", demoList)\n                .name(\"Name\")\n                .onChange((value: any) => {\n                    for (\n                        let i = 0;\n                        i < FluidSimulationDemoBase._DemoList.length;\n                        ++i\n                    ) {\n                        if (FluidSimulationDemoBase._DemoList[i].name === value) {\n                            FluidSimulationDemoBase.StartDemo(i);\n                            break;\n                        }\n                    }\n                });\n            \n            this._gui\n                .add(params, \"environment\", envNames)\n                .name(\"Environment\")\n                .onChange((value: any) => {\n                    this._environmentFile = value;\n                    this._setEnvironment();\n                });\n            \n            this._gui.add({\n                intensity: this._scene.environmentIntensity\n            }, \"intensity\", 1, 100).name(\"Environment Intensity\").onChange((value: number) => {\n                this._scene.environmentIntensity = value;\n            })\n    \n            this._makeGUIMainMenu();\n            \n            if (this._fluidSim && this._particleGenerator) {\n                const menuFluidSim = this._gui.addFolder(\"Fluid Simulator\");\n\n                menuFluidSim.$title.style.fontWeight = \"bold\";\n\n                this._fluidSimGUIElements.push([\n                    menuFluidSim\n                        .add(params, \"numParticles\", 0, 40000, 88)\n                        .name(\"Num particles\")\n                        .onChange((value: any) => {\n                            this._numParticles = value;\n                            this._generateParticles(false);\n                        }),\n                    this,\n                    \"_numParticles\",\n                ]);\n\n                this._fluidSimGUIElements.push([\n                    menuFluidSim\n                        .add(params, \"smoothingRadius\", 0, 2, 0.001)\n                        .name(\"Smoothing radius\")\n                        .onChange((value: any) => {\n                            this._fluidSim!.smoothingRadius = value || 0.04;\n                            this._particleGenerator!.particleRadius =\n                                this._fluidSim!.smoothingRadius / 2;\n                        }),\n                    this._fluidSim,\n                    \"smoothingRadius\",\n                ]);\n\n                this._fluidSimGUIElements.push([\n                    menuFluidSim\n                        .add(params, \"densityReference\", 0, 50000, 100)\n                        .name(\"Density reference\")\n                        .onChange((value: any) => {\n                            this._fluidSim!.densityReference = value;\n                        }),\n                    this._fluidSim,\n                    \"densityReference\",\n                ]);\n\n                this._fluidSimGUIElements.push([\n                    menuFluidSim\n                        .add(params, \"pressureConstant\", 0, 100, 1)\n                        .name(\"Pressure constant\")\n                        .onChange((value: any) => {\n                            this._fluidSim!.pressureConstant = value;\n                        }),\n                    this._fluidSim,\n                    \"pressureConstant\",\n                ]);\n\n                this._fluidSimGUIElements.push([\n                    menuFluidSim\n                        .add(params, \"viscosity\", 0, 0.1, 0.001)\n                        .name(\"Viscosity\")\n                        .onChange((value: any) => {\n                            this._fluidSim!.viscosity = value;\n                        }),\n                    this._fluidSim,\n                    \"viscosity\",\n                ]);\n\n                this._fluidSimGUIElements.push([\n                    menuFluidSim\n                        .add(params, \"maxVelocity\", 0, 20, 1)\n                        .name(\"Max velocity\")\n                        .onChange((value: any) => {\n                            this._fluidSim!.maxVelocity = value;\n                        }),\n                    this._fluidSim,\n                    \"maxVelocity\",\n                ]);\n\n                this._fluidSimGUIElements.push([\n                    menuFluidSim\n                        .add(params, \"maxAcceleration\", 0, 100000, 10)\n                        .name(\"Max acceleration\")\n                        .onChange((value: any) => {\n                            this._fluidSim!.maxAcceleration = value;\n                        }),\n                    this._fluidSim,\n                    \"maxAcceleration\",\n                ]);\n\n                this._fluidSimGUIElements.push([\n                    menuFluidSim\n                        .add(params, \"minTimeStep\", 0, 0.01, 0.00001)\n                        .name(\"Min time step\")\n                        .onChange((value: any) => {\n                            this._fluidSim!.minTimeStep = value;\n                        }),\n                    this._fluidSim,\n                    \"minTimeStep\",\n                ]);\n\n                this._fluidSimGUIElements.push([\n                    menuFluidSim\n                        .add(params, \"shapeCollisionRestitution\", 0, 1, 0.001)\n                        .name(\"Collision restitution\")\n                        .onChange((value: any) => {\n                            this._shapeCollisionRestitution = value;\n                        }),\n                    this,\n                    \"_shapeCollisionRestitution\",\n                ]);\n\n                menuFluidSim\n                    .add(params, \"paused\")\n                    .name(\"Pause\")\n                    .onChange((value: boolean) => {\n                        this._onPaused(value);\n                    });\n\n                menuFluidSim.open();\n            }\n        }\n    }\n\n    protected _onPaused(value: boolean) {\n        this._paused = value;\n    }\n\n    protected _checkCollisions(particleRadius: number): void {\n        if (this._collisionObjects.length === 0) {\n            return;\n        }\n\n        const positions = this._fluidSim!.positions;\n        const velocities = this._fluidSim!.velocities;\n\n        const tmpQuat = BABYLON.TmpVectors.Quaternion[0];\n        const tmpScale = BABYLON.TmpVectors.Vector3[0];\n\n        tmpScale.copyFromFloats(1, 1, 1);\n\n        for (let i = 0; i < this._collisionObjects.length; ++i) {\n            const shape = this._collisionObjects[i][1];\n\n            const quat =\n                shape.mesh?.rotationQuaternion ??\n                shape.rotationQuaternion ??\n                BABYLON.Quaternion.FromEulerAnglesToRef(\n                    shape.mesh?.rotation.x ?? shape.rotation!.x,\n                    shape.mesh?.rotation.y ?? shape.rotation!.y,\n                    shape.mesh?.rotation.z ?? shape.rotation!.z,\n                    tmpQuat\n                );\n            BABYLON.Matrix.ComposeToRef(\n                tmpScale,\n                quat,\n                shape.mesh?.position ?? shape.position!,\n                shape.transf\n            );\n\n            shape.transf.invertToRef(shape.invTransf);\n        }\n\n        const pos = BABYLON.TmpVectors.Vector3[4];\n        const normal = BABYLON.TmpVectors.Vector3[7];\n\n        for (let a = 0; a < this._fluidSim!.currentNumParticles; ++a) {\n            const px = positions[a * 3 + 0];\n            const py = positions[a * 3 + 1];\n            const pz = positions[a * 3 + 2];\n\n            for (let i = 0; i < this._collisionObjects.length; ++i) {\n                const shape = this._collisionObjects[i][1];\n                if (shape.disabled) {\n                    continue;\n                }\n\n                pos.copyFromFloats(px, py, pz);\n                BABYLON.Vector3.TransformCoordinatesToRef(\n                    pos,\n                    shape.invTransf,\n                    pos\n                );\n                pos.scaleInPlace(1 / shape.scale);\n                const dist =\n                    shape.scale * shape.sdEvaluate(pos, ...shape.params) -\n                    particleRadius;\n                if (dist < 0) {\n                    shape.computeNormal(pos, shape, normal);\n\n                    const restitution =\n                        shape.collisionRestitution ??\n                        this._shapeCollisionRestitution;\n\n                    const dotvn =\n                        velocities[a * 3 + 0] * normal.x +\n                        velocities[a * 3 + 1] * normal.y +\n                        velocities[a * 3 + 2] * normal.z;\n\n                    velocities[a * 3 + 0] =\n                        (velocities[a * 3 + 0] - 2 * dotvn * normal.x) *\n                        restitution;\n                    velocities[a * 3 + 1] =\n                        (velocities[a * 3 + 1] - 2 * dotvn * normal.y) *\n                        restitution;\n                    velocities[a * 3 + 2] =\n                        (velocities[a * 3 + 2] - 2 * dotvn * normal.z) *\n                        restitution;\n\n                    positions[a * 3 + 0] -= normal.x * dist;\n                    positions[a * 3 + 1] -= normal.y * dist;\n                    positions[a * 3 + 2] -= normal.z * dist;\n                }\n            }\n        }\n    }\n}\n"],"names":["FluidRendererGUI","constructor","scene","showGeneralMenu","this","_scene","_showGeneralMenu","_visible","_onKeyObserver","_targetRendererIndex","_targetRenderersGUIElements","_renderObjectIndex","_renderObjectsGUIElements","_gui","initialize","visible","v","domElement","style","display","dispose","oldgui","document","getElementById","remove","onKeyboardObservable","_setupKeyboard","add","kbInfo","type","event","key","title","marginTop","id","_makeMenuGeneral","_makeMenuTargetRenderers","_makeMenuRenderObjects","_addList","menu","params","name","friendlyName","list","onChange","value","_parameterChanged","_addCheckbox","_addSlider","min","max","step","_addColor","addColor","enable","_parameterRead","general","addFolder","$title","fontWeight","open","fluidRenderer","targetRenderers","length","targets_index","targets_generateDiffuseTexture","targets_fluidColor","targets_surfaceColor","targets_density","targets_refractionStrength","targets_fresnelClamp","targets_specularPower","targets_minimumThickness","targets_debug","targets_debugFeature","targets_enableBlurDepth","targets_blurDepthSizeDivisor","targets_blurDepthFilterSize","targets_blurDepthNumIterations","targets_blurDepthMaxFilterSize","targets_blurDepthDepthScale","targets_enableBlurThickness","targets_blurThicknessSizeDivisor","targets_blurThicknessFilterSize","targets_blurThicknessNumIterations","targets_depthMapSize","targets_thicknessMapSize","targets_diffuseMapSize","targets_useVelocity","targets_useFixedThickness","targetList","i","push","menuColor","fontStyle","menuBlurDepth","menuBlurThickness","menuDebug","Object","keys","FluidRenderingDebug","filter","k","isNaN","Number","renderObjects","objects_index","objects_particleSize","objects_particleThicknessAlpha","objectList","_readValue","obj","parts","split","part","toHexString","endsWith","_setValue","startsWith","substring","object","_fillValues","listGUIElements","elem","property","updateDisplay","syncGUI","enableFluidRenderer","disableFluidRenderer","fluidColor","copyFrom","surfaceColor","typedDebugFeature","val","debugFeature","parseFloat","FluidSimulator","positions","velocities","mass","_smoothingRadius","densityReference","pressureConstant","viscosity","gravity","minTimeStep","maxVelocity","maxAcceleration","_positions","undefined","_velocities","_particles","_numMaxParticles","_mass","setParticleData","_hash","Hash","currentNumParticles","_smoothingRadius2","_poly6Constant","_spikyConstant","_viscConstant","_computeConstants","smoothingRadius","radius","m","Math","PI","pow","numMaxParticles","Float32Array","density","pressure","accelX","accelY","accelZ","update","deltaTime","timeLeft","create","_computeDensityAndPressure","_computeAcceleration","timeStep","_calculateTimeStep","_updatePositions","a","pA","paX","paY","paZ","query","ib","querySize","b","queryIds","diffX","diffY","diffZ","r2","w","vaX","vaY","vaZ","pressureAccelX","pressureAccelY","pressureAccelZ","viscosityAccelX","viscosityAccelY","viscosityAccelZ","r","sqrt","pB","massRatio","fp","fv","x","y","z","mag","maxSpeedOfSound","velSq","accSq","spsSq","velStep","accStep","spsStep","spacing","maxNumObjects","_spacing","_tableSize","_cellStart","Int32Array","_cellEntries","_queryIds","_querySize","hashCoords","xi","yi","zi","h","abs","intCoord","coord","floor","hashPos","pos","nr","numElements","numObjects","fill","start","maxDist","x0","y0","z0","x1","y1","z1","end","ParticleGenerator","loadFromFile","_numParticles","_currNumParticles","_numCrossSection","particleRadius","_loadFromFile","position","_observer","onBeforeRenderObservable","px1","py1","pz1","px2","py2","pz2","currNumParticles","async","numTotParticles","regenerateAll","_generateParticlesFromFile","_generateParticles","fileName","lines","fetch","text","replace","particlePos","particleVel","numParticles","line","vals","charAt","newPositions","newVelocities","set","particleStartIndex","distance","jitter","getJitter","random","yCoord","dimY","angle","x2","sin","xCoord","xc","yc","zCoord","eps","eps1","eps2","eps3","eps4","dir1","dir2","dir3","dir4","SDFHelper","static","shape","extents","box","width","height","depth","material","metallic","roughness","albedoTexture","cullBackFaces","Promise","resolve","s","sphere","diameter","segments","planeDist","thickness","plane","size","rotation","csg1","csgp","subtractInPlace","mesh","toMesh","computeWorldMatrix","refreshBoundingInfo","scaling","setAll","getBoundingInfo","boundingBox","maximumWorld","csg2","meshFinal","bakeCurrentTransformIntoVertices","cylinder","tessellation","ground","subdivisions","maxHeight","onReady","updateCoordinateHeights","mat","metallicTexture","bumpTexture","useRoughnessFromMetallicTextureGreen","textData","dimLine","dimX","dimZ","originLine","origin","data","meshFilename","sdfFilename","createNormals","promises","then","response","_ParseSDFData","all","results","meshes","scale","p","q","copyFromFloats","tmp","maximizeInPlaceFromFloats","n","t","qx","qy","dx","dy","dx2","dy2","terrain","getHeightAtCoordinates","sdf","gx","gy","gz","fx","fy","fz","a00","a10","a11","b00","b10","b11","normal","posTemp","dir","addInPlace","scaleInPlace","sdEvaluate","transf","normalize","getNormalAtCoordinatesToRef","envNames","FluidSimulationDemoBase","noFluidSimulation","particleFileName","_engine","getEngine","_fluidRenderer","_paused","_fluidRendererGUI","_sceneObserver","_fluidSim","_particleGenerator","_loadParticlesFromFile","_shapeCollisionRestitution","_collisionObjectPromises","_collisionObjects","_environmentFile","_fluidSimGUIElements","_noFluidSimulation","camera","activeCameras","activeCamera","storeState","_fluidRenderObject","addVertexBuffer","targetRenderer","enableBlurDepth","blurDepthFilterSize","blurDepthNumIterations","blurDepthDepthScale","refractionStrength","specularPower","blurThicknessFilterSize","blurThicknessNumIterations","dirLight","particleSize","particleThicknessAlpha","useVelocity","minimumThickness","window","fsim","factory","_DemoList","index","_CurrentDemo","_CurrentDemoIndex","run","_setEnvironment","hdrTexture","createDefaultSkybox","getMeshById","setEnabled","environmentIntensity","clearColor","_run","_makeGUI","setNumParticles","_checkCollisions","vertexBuffers","updateDirectly","disposeCollisionObject","splice","destroy","removeRenderObject","_restoreStateValues","addCollisionSphere","dragPlane","collisionRestitution","dontCreateMesh","collisionShape","createMesh","computeNormal","clone","invTransf","promise","_createMeshForCollision","addCollisionBox","addCollisionPlane","d","addCollisionCutHollowSphere","addCollisionVerticalCylinder","addCollisionMesh","addCollisionTerrain","rotationQuaternion","generateParticles","_makeGUIMainMenu","_syncFluidSimGUI","left","demo","environment","paused","shapeCollisionRestitution","demoList","StartDemo","intensity","menuFluidSim","_onPaused","tmpQuat","tmpScale","quat","invertToRef","px","py","pz","disabled","dist","restitution","dotvn"],"sourceRoot":""}