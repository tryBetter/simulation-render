"use strict";(self.webpackChunkbabylonjs_fluid_rendering=self.webpackChunkbabylonjs_fluid_rendering||[]).push([[365],{2365:(e,t,i)=>{i.r(t),i.d(t,{FluidSimulationDemoBoxSphere:()=>n});var s=i(6291),o=i(9820);const a=i.p+"3a7e30d32bdbb158c31616b73b274b90.glb";class n extends o.FluidSimulationDemoBase{constructor(e){super(e),this._sphereMesh=null,this._wallMesh=null,this._customRootMesh=null;const t=.35;this._boxMin=new s.Vector3(-.35,-.35,-.35),this._boxMax=new s.Vector3(t,t,t),this._boxMesh=null,this._boxMaterial=null,this._boxMeshFront=null,this._boxMaterialFront=null,this._checkXZBounds=!0,this._origCollisionPlanes=[new s.Plane(0,0,-1,Math.abs(this._boxMax.z)),new s.Plane(0,0,1,Math.abs(this._boxMin.z)),new s.Plane(1,0,0,Math.abs(this._boxMin.x)),new s.Plane(-1,0,0,Math.abs(this._boxMax.x)),new s.Plane(0,-1,0,Math.abs(this._boxMax.y)),new s.Plane(0,1,0,Math.abs(this._boxMin.y)),new s.Plane(0,1,0,Math.abs(this._boxMin.y))],this._collisionPlanes=[];for(let e=0;e<this._origCollisionPlanes.length;++e){const t=this._origCollisionPlanes[e];this.addCollisionPlane(t.normal,t.d,e===this._origCollisionPlanes.length-1?.98:void 0)}this._angleX=0,this._angleY=0,this._prevTransfo=s.Matrix.Identity(),this._autoRotateBox=!1,this._sceneRenderObserver=null,this._sceneAfterCameraRenderObserver=null,this._sceneKeyboardObserver=null,this._onEngineResizeObserver=null,this.loadCustomModel(),this._setCustomDebugLayer()}_setCustomDebugLayer(){const e={Shift:!1,D:!1};this._scene.onKeyboardObservable.add((t=>{switch(t.type){case s.KeyboardEventTypes.KEYDOWN:e[t.event.key]=!0;break;case s.KeyboardEventTypes.KEYUP:e[t.event.key]=!1}e.Shift&&e.D&&(this._scene.debugLayer.isVisible()?this._scene.debugLayer.hide():this._scene.debugLayer.show({overlay:!0}))}))}loadCustomModel(){let e,t,i;s.SceneLoader.AppendAsync("",a,this._scene).then((o=>{var a;this._customRootMesh=o.getMeshByName("__root__"),null===(a=this._customRootMesh)||void 0===a||a.scaling.set(.1,.1,.1);const n=[{intensity:0,diffuseColor:s.Color3.FromInts(174.93,255,70.125),specularColor:s.Color3.FromInts(0,222.105,255),position:new s.Vector3(0,0,-6.294)},{intensity:0,diffuseColor:s.Color3.FromInts(0,220.065,255),specularColor:s.Color3.FromInts(0,255,.678*255),position:new s.Vector3(.178,-.037,6.285)}];let r;o.lights.forEach(((e,t)=>{const i=e;void 0===r&&(r=i.parent,r.position.set(0,0,0)),r.position.set(0,0,0),i.parent=r,i.position.copyFrom(n[t].position),i.intensity=n[t].intensity,i.diffuse.copyFrom(n[t].diffuseColor),i.specular.copyFrom(n[t].specularColor)})),this._scene.registerBeforeRender((()=>{var e,t;void 0!==r&&(r.rotationQuaternion=null,r.rotation.y=(null!==(t=null===(e=this._scene.activeCameras)||void 0===e?void 0:e[0])&&void 0!==t?t:this._scene.activeCamera).alpha+Math.PI)}));const l=[];o.meshes.forEach((o=>{if(o&&o.name&&o.material)switch(o.name){case"立方体.006_Baked":o.material.alpha=.4,o.alphaIndex=4,o.material.transparencyMode=s.Material.MATERIAL_ALPHABLEND,o.material.alphaMode=s.Engine.ALPHA_COMBINE;const a=o.material;a.metallic=1,a.roughness=.2,a.albedoColor.r=.5,a.albedoColor.g=.04,a.albedoColor.b=1,a.metallicReflectanceColor.r=.97,a.metallicReflectanceColor.g=.029,a.metallicReflectanceColor.b=1,a.anisotropy.isEnabled=!0,a.anisotropy.intensity=.8,a.sheen.isEnabled=!0,a.sheen.intensity=1,a.sheen.color.r=.816,a.sheen.color.g=.006,a.sheen.color.b=1,a.sheen.useRoughnessFromMainTexture=!0,a.subSurface.tintColor.r=.541,a.subSurface.tintColor.g=.933,a.subSurface.tintColor.b=1,a.subSurface.isScatteringEnabled=!0,a.subSurface.isTranslucencyEnabled=!0,a.disableDepthWrite=!0;break;case"布尔":o.visibility=0,e=o;break;case"柱体.001_Baked":case"边线_Baked":o.visibility=0;break;case"平面_primitive0":o.visibility=0,t=o;break;case"平面_primitive1":o.visibility=0,i=o;break;case"立方体.011_Baked":l.push(o),o.alphaIndex=4,o.material.alpha=.95,o.material.alphaMode=s.Engine.ALPHA_MULTIPLY,o.material.transparencyMode=s.Material.MATERIAL_ALPHATEST,o.material.emissiveColor=s.Color3.FromInts(3.4,0,51),o.material.metallic=1,o.material.roughness=0;break;case"立方体.013_Baked":l.push(o),o.alphaIndex=4,o.material.alpha=.6,o.material.alphaMode=s.Engine.ALPHA_MULTIPLY,o.material.transparencyMode=s.Material.MATERIAL_ALPHATEST,o.material.emissiveColor=s.Color3.FromInts(12.6,0,148),o.material.metallic=.93,o.material.roughness=0;break;case"立方体.012_Baked":case"立方体.014_Baked":l.push(o),o.alphaIndex=3,o.material.alpha=.26,o.material.transparencyMode=s.Material.MATERIAL_ALPHABLEND,o.material.alphaMode=s.Engine.ALPHA_ADD,o.material.emissiveColor=s.Color3.FromInts(.059,.161,1),o.material.metallic=1,o.material.roughness=.15}}))}))}async _run(){var e,t;for(let e=0;e<this._origCollisionPlanes.length;++e)this._collisionPlanes.push(this._collisionObjects[e]);this._collisionPlanes[this._collisionPlanes.length-1][1].disabled=!0;const i=null!==(t=null===(e=this._scene.activeCameras)||void 0===e?void 0:e[0])&&void 0!==t?t:this._scene.activeCamera,o=new s.Scene(this._scene.getEngine()),a=new s.ArcRotateCamera("camera",1.74,-.0071,10,s.Vector3.Zero(),o);a.lowerBetaLimit=2*-Math.PI,a.upperBetaLimit=2*Math.PI,a.lowerRadiusLimit=1,a.upperRadiusLimit=1,a.attachControl(document.getElementById("renderCanvas"),!0),o.attachControl(!0,!0,!0),o.clearColor=new s.Color4(0,0,0,0),o.autoClear=!1,this._scene.onAfterCameraRenderObservable.add((()=>{o.render(),this._customRootMesh&&(this._customRootMesh.rotationQuaternion=a.absoluteRotation,this._rotateMeshes(-a.alpha,-a.beta))})),i&&(i.alpha=1,i.beta=1.1,i.radius=1.9,i.panningSensibility=0,i.lowerAlphaLimit=1,i.upperAlphaLimit=1,i.lowerBetaLimit=1.1,i.upperBetaLimit=1.1,i.lowerRadiusLimit=1.9,i.upperRadiusLimit=1.9),this._fluidRenderObject.object.particleSize=.08,this._fluidRenderObject.object.particleThicknessAlpha=.103,this._fluidSim.smoothingRadius=.04,this._fluidSim.densityReference=2e4,this._fluidSim.pressureConstant=4,this._fluidSim.viscosity=.01,this._fluidSim.maxVelocity=6,this._fluidSim.maxAcceleration=48e3,this._onEngineResizeObserver=this._engine.onResizeObservable.add((()=>{var e;null===(e=null==i?void 0:i.outputRenderTarget)||void 0===e||e.resize({width:this._engine.getRenderWidth(!0),height:this._engine.getRenderHeight(!0)})})),super._run(),setTimeout((()=>{document.getElementById("renderCanvas").style.opacity="1.0"}),800)}dispose(){var e,t,i,s,o,a;super.dispose();const n=null!==(t=null===(e=this._scene.activeCameras)||void 0===e?void 0:e[0])&&void 0!==t?t:this._scene.activeCamera;n&&(null===(i=n.outputRenderTarget)||void 0===i||i.dispose(),n.outputRenderTarget=null),this._scene.onBeforeRenderObservable.remove(this._sceneRenderObserver),this._scene.onAfterCameraRenderObservable.remove(this._sceneAfterCameraRenderObserver),this._scene.onKeyboardObservable.remove(this._sceneKeyboardObserver),null===(s=this._boxMesh)||void 0===s||s.dispose(),null===(o=this._boxMeshFront)||void 0===o||o.dispose(),null===(a=this._boxMaterial)||void 0===a||a.dispose(),this._engine.onResizeObservable.remove(this._onEngineResizeObserver)}_makeGUIMainMenu(){const e={checkXZBounds:!0,autoRotateBox:!1,restart:()=>{this._angleX=this._angleY=0,this._autoRotateBox=!1,null==i||i.setValue(!1),this._rotateMeshes(0,0),this._generateParticles()}},t=this._gui;let i=null;t.add(e,"restart").name("Restart"),t.add(e,"checkXZBounds").name("Check box bounds").onChange((e=>{var t,s;this._checkXZBounds=e,null===(t=this._boxMesh)||void 0===t||t.setEnabled(e),null===(s=this._boxMeshFront)||void 0===s||s.setEnabled(e);for(let t=0;t<this._collisionPlanes.length;++t)this._collisionPlanes[t][1].disabled=!e&&t<this._collisionPlanes.length-1||e&&t===this._collisionPlanes.length-1;e||(this._autoRotateBox=!1,null==i||i.setValue(!1))})),i=t.add(e,"autoRotateBox").name("Auto rotate box").onChange((e=>{this._autoRotateBox=e}))}_onPaused(e){super._onPaused(e),e&&(this._autoRotateBox=!1)}_rotateMeshes(e,t){var i;const o=s.Matrix.RotationYawPitchRoll(e,0,t),a=[new s.Vector3(this._boxMin.x,this._boxMin.y,this._boxMin.z),new s.Vector3(this._boxMin.x,this._boxMax.y,this._boxMin.z),new s.Vector3(this._boxMin.x,this._boxMax.y,this._boxMax.z),new s.Vector3(this._boxMin.x,this._boxMin.y,this._boxMax.z),new s.Vector3(this._boxMax.x,this._boxMin.y,this._boxMin.z),new s.Vector3(this._boxMax.x,this._boxMax.y,this._boxMin.z),new s.Vector3(this._boxMax.x,this._boxMax.y,this._boxMax.z),new s.Vector3(this._boxMax.x,this._boxMin.y,this._boxMax.z)];let n=1e10;for(let e=0;e<a.length;++e){const t=s.Vector3.TransformCoordinates(a[e],o);n=Math.min(n,t.y)}this._collisionPlanes[this._origCollisionPlanes.length-1][1].params[1]=Math.abs(n)+.02;for(let e=0;e<this._origCollisionPlanes.length-1;++e){const t=this._origCollisionPlanes[e].transform(o);this._collisionPlanes[e][1].params=[t.normal,t.d]}const r=s.Quaternion.FromRotationMatrix(o);if(this._prevTransfo.invert(),this._sphereMesh){const e=s.Vector3.TransformCoordinates(this._sphereMesh.position,this._prevTransfo);this._sphereMesh.rotationQuaternion=r,this._sphereMesh.position=s.Vector3.TransformCoordinates(e,o)}if(this._wallMesh){const e=s.Vector3.TransformCoordinates(this._wallMesh.position,this._prevTransfo),t=s.Matrix.RotationYawPitchRoll(0,90*Math.PI/180,0),a=s.Matrix.Translation(e.x,e.y,e.z);t.multiplyToRef(a,t).multiplyToRef(o,t);const n=null!==(i=this._wallMesh.rotationQuaternion)&&void 0!==i?i:new s.Quaternion;t.decompose(void 0,n,this._wallMesh.position),this._wallMesh.rotationQuaternion=n}this._boxMesh&&this._boxMeshFront&&(this._boxMesh.rotationQuaternion=this._boxMeshFront.rotationQuaternion=r,this._boxMesh.position.x=(this._boxMin.x+this._boxMax.x)/2,this._boxMesh.position.y=(this._boxMin.y+this._boxMax.y)/2,this._boxMesh.position.z=(this._boxMin.z+this._boxMax.z)/2,this._boxMesh.position=s.Vector3.TransformCoordinates(this._boxMesh.position,o),this._boxMeshFront.position=this._boxMesh.position),this._prevTransfo.copyFrom(o)}}}}]);
//# sourceMappingURL=365.c072e2ad5a849569f168.js.map