{"version":3,"file":"287.09461e5477355dfb7e3d.js","mappings":"gKAIO,MAAMA,EAgBTC,YAAYC,EAAiBC,GACzBC,KAAKC,SAAWH,EAChBE,KAAKE,WAAa,EAAIH,EACtBC,KAAKG,WAAa,IAAIC,WAAWJ,KAAKE,WAAa,GACnDF,KAAKK,aAAe,IAAID,WAAWL,GACnCC,KAAKM,UAAY,IAAIF,WAAWL,GAChCC,KAAKO,WAAa,CACtB,CAfWC,gBACP,OAAOR,KAAKO,UAChB,CAEWE,eACP,OAAOT,KAAKM,SAChB,CAWOI,WAAWC,EAAYC,EAAYC,GACtC,MAAMC,EAAU,SAALH,EAAuB,UAALC,EAAwB,UAALC,EAEhD,OAAOE,KAAKC,IAAIF,GAAKd,KAAKE,UAC9B,CAEOe,SAASC,GACZ,OAAOH,KAAKI,MAAMD,EAAQlB,KAAKC,SACnC,CAEOmB,QAAQC,EAA8BC,GACzC,OAAOtB,KAAKU,WACRV,KAAKiB,SAASI,EAAI,EAAIC,IACtBtB,KAAKiB,SAASI,EAAI,EAAIC,EAAK,IAC3BtB,KAAKiB,SAASI,EAAI,EAAIC,EAAK,IAEnC,CAEOC,OAAOF,EAA8BG,GACxCA,EAAcA,QAAAA,EAAeH,EAAII,OAAS,EAE1C,MAAMC,EAAaX,KAAKY,IAAIH,EAAaxB,KAAKK,aAAaoB,QAG3DzB,KAAKG,WAAWyB,KAAK,GACrB5B,KAAKK,aAAauB,KAAK,GAEvB,IAAK,IAAIC,EAAI,EAAGA,EAAIH,EAAYG,IAAK,CACjC,MAAMf,EAAId,KAAKoB,QAAQC,EAAKQ,GAC5B7B,KAAKG,WAAWW,I,CAIpB,IAAIgB,EAAQ,EACZ,IAAK,IAAID,EAAI,EAAGA,EAAI7B,KAAKE,WAAY2B,IACjCC,GAAS9B,KAAKG,WAAW0B,GACzB7B,KAAKG,WAAW0B,GAAKC,EAEzB9B,KAAKG,WAAWH,KAAKE,YAAc4B,EAGnC,IAAK,IAAID,EAAI,EAAGA,EAAIH,EAAYG,IAAK,CACjC,MAAMf,EAAId,KAAKoB,QAAQC,EAAKQ,GAC5B7B,KAAKG,WAAWW,KAChBd,KAAKK,aAAaL,KAAKG,WAAWW,IAAMe,C,CAEhD,CAEOE,MAAMV,EAA8BC,EAAYU,GACnD,MAAMC,EAAKjC,KAAKiB,SAASI,EAAI,EAAIC,GAAMU,GACjCE,EAAKlC,KAAKiB,SAASI,EAAI,EAAIC,EAAK,GAAKU,GACrCG,EAAKnC,KAAKiB,SAASI,EAAI,EAAIC,EAAK,GAAKU,GAErCI,EAAKpC,KAAKiB,SAASI,EAAI,EAAIC,GAAMU,GACjCK,EAAKrC,KAAKiB,SAASI,EAAI,EAAIC,EAAK,GAAKU,GACrCM,EAAKtC,KAAKiB,SAASI,EAAI,EAAIC,EAAK,GAAKU,GAE3ChC,KAAKO,WAAa,EAElB,IAAK,IAAII,EAAKsB,EAAItB,GAAMyB,EAAIzB,IACxB,IAAK,IAAIC,EAAKsB,EAAItB,GAAMyB,EAAIzB,IACxB,IAAK,IAAIC,EAAKsB,EAAItB,GAAMyB,EAAIzB,IAAM,CAC9B,MAAMC,EAAId,KAAKU,WAAWC,EAAIC,EAAIC,GAC5BiB,EAAQ9B,KAAKG,WAAWW,GACxByB,EAAMvC,KAAKG,WAAWW,EAAI,GAEhC,IAAK,IAAIe,EAAIC,EAAOD,EAAIU,EAAKV,IACzB7B,KAAKM,UAAUN,KAAKO,YAAcP,KAAKK,aAAawB,GACpD7B,KAAKO,Y,CAKzB,E","sources":["webpack://babylonjs-fluid-rendering/./src/scenes/FluidSimulator2/hash.ts"],"sourcesContent":["/**\n * From https://github.com/matthias-research/pages/blob/master/tenMinutePhysics/11-hashing.html\n */\n\nexport class Hash {\n    private _spacing: number;\n    private _tableSize: number;\n    private _cellStart: Int32Array;\n    private _cellEntries: Int32Array;\n    private _queryIds: Int32Array;\n    private _querySize: number;\n\n    public get querySize() {\n        return this._querySize;\n    }\n\n    public get queryIds() {\n        return this._queryIds;\n    }\n\n    constructor(spacing: number, maxNumObjects: number) {\n        this._spacing = spacing;\n        this._tableSize = 2 * maxNumObjects;\n        this._cellStart = new Int32Array(this._tableSize + 1);\n        this._cellEntries = new Int32Array(maxNumObjects);\n        this._queryIds = new Int32Array(maxNumObjects);\n        this._querySize = 0;\n    }\n\n    public hashCoords(xi: number, yi: number, zi: number) {\n        const h = (xi * 92837111) ^ (yi * 689287499) ^ (zi * 283923481); // fantasy function\n        //const h = (xi * 73856093) ^ (yi * 19349663) ^ (zi * 83492791); // fantasy function\n        return Math.abs(h) % this._tableSize;\n    }\n\n    public intCoord(coord: number) {\n        return Math.floor(coord / this._spacing);\n    }\n\n    public hashPos(pos: number[] | Float32Array, nr: number) {\n        return this.hashCoords(\n            this.intCoord(pos[3 * nr]),\n            this.intCoord(pos[3 * nr + 1]),\n            this.intCoord(pos[3 * nr + 2])\n        );\n    }\n\n    public create(pos: number[] | Float32Array, numElements?: number) {\n        numElements = numElements ?? pos.length / 3;\n\n        const numObjects = Math.min(numElements, this._cellEntries.length);\n\n        // determine cell sizes\n        this._cellStart.fill(0);\n        this._cellEntries.fill(0);\n\n        for (let i = 0; i < numObjects; i++) {\n            const h = this.hashPos(pos, i);\n            this._cellStart[h]++;\n        }\n\n        // determine cells starts\n        let start = 0;\n        for (let i = 0; i < this._tableSize; i++) {\n            start += this._cellStart[i];\n            this._cellStart[i] = start;\n        }\n        this._cellStart[this._tableSize] = start; // guard\n\n        // fill in objects ids\n        for (let i = 0; i < numObjects; i++) {\n            const h = this.hashPos(pos, i);\n            this._cellStart[h]--;\n            this._cellEntries[this._cellStart[h]] = i;\n        }\n    }\n\n    public query(pos: number[] | Float32Array, nr: number, maxDist: number) {\n        const x0 = this.intCoord(pos[3 * nr] - maxDist);\n        const y0 = this.intCoord(pos[3 * nr + 1] - maxDist);\n        const z0 = this.intCoord(pos[3 * nr + 2] - maxDist);\n\n        const x1 = this.intCoord(pos[3 * nr] + maxDist);\n        const y1 = this.intCoord(pos[3 * nr + 1] + maxDist);\n        const z1 = this.intCoord(pos[3 * nr + 2] + maxDist);\n\n        this._querySize = 0;\n\n        for (let xi = x0; xi <= x1; xi++) {\n            for (let yi = y0; yi <= y1; yi++) {\n                for (let zi = z0; zi <= z1; zi++) {\n                    const h = this.hashCoords(xi, yi, zi);\n                    const start = this._cellStart[h];\n                    const end = this._cellStart[h + 1];\n\n                    for (let i = start; i < end; i++) {\n                        this._queryIds[this._querySize] = this._cellEntries[i];\n                        this._querySize++;\n                    }\n                }\n            }\n        }\n    }\n}\n"],"names":["Hash","constructor","spacing","maxNumObjects","this","_spacing","_tableSize","_cellStart","Int32Array","_cellEntries","_queryIds","_querySize","querySize","queryIds","hashCoords","xi","yi","zi","h","Math","abs","intCoord","coord","floor","hashPos","pos","nr","create","numElements","length","numObjects","min","fill","i","start","query","maxDist","x0","y0","z0","x1","y1","z1","end"],"sourceRoot":""}