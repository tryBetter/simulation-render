"use strict";(self.webpackChunkbabylonjs_fluid_rendering=self.webpackChunkbabylonjs_fluid_rendering||[]).push([[692],{5692:(e,t,r)=>{r.r(t),r.d(t,{FluidRendererGUI:()=>n});var s=r(6291),i=r(1063),a=r(7419);class n{constructor(e,t=!0){this._scene=e,this._showGeneralMenu=t,this._visible=!1,this._onKeyObserver=null,this._targetRendererIndex=0,this._targetRenderersGUIElements=[],this._renderObjectIndex=0,this._renderObjectsGUIElements=[],this._gui=null,this.initialize()}set visible(e){e!==this._visible&&(this._visible=e,this._gui&&(this._gui.domElement.style.display=e?"":"none"))}dispose(){const e=document.getElementById("datGUI");null!==e&&(e.remove(),this._gui=null),this._scene.onKeyboardObservable.remove(this._onKeyObserver),this._onKeyObserver=null}_setupKeyboard(){this._onKeyObserver=this._scene.onKeyboardObservable.add((e=>{switch(e.type){case s.KeyboardEventTypes.KEYDOWN:break;case s.KeyboardEventTypes.KEYUP:"F8"===e.event.key&&(this.visible=!this._visible)}}))}initialize(){this.dispose(),this._gui=new i.XS({title:"Fluid Rendering"}),this._gui.domElement.style.display="none",this._gui.domElement.style.marginTop="60px",this._gui.domElement.id="datGUI",this._setupKeyboard(),this._showGeneralMenu&&this._makeMenuGeneral(),this._makeMenuTargetRenderers(),this._makeMenuRenderObjects()}_addList(e,t,r,s,i){return e.add(t,r,i).name(s).onChange((e=>{this._parameterChanged(r,e)}))}_addCheckbox(e,t,r,s){return e.add(t,r).name(s).onChange((e=>{this._parameterChanged(r,e)}))}_addSlider(e,t,r,s,i,a,n){return e.add(t,r,i,a,n).name(s).onChange((e=>{this._parameterChanged(r,e)}))}_addColor(e,t,r,s){return e.addColor(t,r).name(s).onChange((e=>{this._parameterChanged(r,e)}))}_makeMenuGeneral(){if(!this._gui)return;const e={enable:this._parameterRead("enable")},t=this._gui.addFolder("General");t.$title.style.fontWeight="bold",this._addCheckbox(t,e,"enable","Enable fluid renderer"),t.open()}_makeMenuTargetRenderers(){var e,t;if(!this._gui||null===(t=null===(e=this._scene.fluidRenderer)||void 0===e?void 0:e.targetRenderers.length)||void 0===t||!t)return;const r={targets_index:this._parameterRead("targets_index"),targets_generateDiffuseTexture:this._parameterRead("targets_generateDiffuseTexture"),targets_fluidColor:this._parameterRead("targets_fluidColor"),targets_surfaceColor:this._parameterRead("targets_surfaceColor"),targets_density:this._parameterRead("targets_density"),targets_refractionStrength:this._parameterRead("targets_refractionStrength"),targets_fresnelClamp:this._parameterRead("targets_fresnelClamp"),targets_specularPower:this._parameterRead("targets_specularPower"),targets_minimumThickness:this._parameterRead("targets_minimumThickness"),targets_debug:this._parameterRead("targets_debug"),targets_debugFeature:this._parameterRead("targets_debugFeature"),targets_enableBlurDepth:this._parameterRead("targets_enableBlurDepth"),targets_blurDepthSizeDivisor:this._parameterRead("targets_blurDepthSizeDivisor"),targets_blurDepthFilterSize:this._parameterRead("targets_blurDepthFilterSize"),targets_blurDepthNumIterations:this._parameterRead("targets_blurDepthNumIterations"),targets_blurDepthMaxFilterSize:this._parameterRead("targets_blurDepthMaxFilterSize"),targets_blurDepthDepthScale:this._parameterRead("targets_blurDepthDepthScale"),targets_enableBlurThickness:this._parameterRead("targets_enableBlurThickness"),targets_blurThicknessSizeDivisor:this._parameterRead("targets_blurThicknessSizeDivisor"),targets_blurThicknessFilterSize:this._parameterRead("targets_blurThicknessFilterSize"),targets_blurThicknessNumIterations:this._parameterRead("targets_blurThicknessNumIterations"),targets_depthMapSize:this._parameterRead("targets_depthMapSize"),targets_thicknessMapSize:this._parameterRead("targets_thicknessMapSize"),targets_diffuseMapSize:this._parameterRead("targets_diffuseMapSize"),targets_useVelocity:this._parameterRead("targets_useVelocity"),targets_useFixedThickness:this._parameterRead("targets_useFixedThickness")},s=this._gui.addFolder("Target renderers");s.$title.style.fontWeight="bold";const i=[];if(this._scene.fluidRenderer)for(let e=0;e<this._scene.fluidRenderer.targetRenderers.length;++e)i.push(e);this._addList(s,r,"targets_index","Index",i),this._targetRenderersGUIElements.push(this._addList(s,r,"targets_depthMapSize","Depth map size",["Screen size",256,512,1024,2048,4096])),this._targetRenderersGUIElements.push(this._addList(s,r,"targets_thicknessMapSize","Thickness map size",["Screen size",64,128,256,512,1024,2048])),this._targetRenderersGUIElements.push(this._addList(s,r,"targets_diffuseMapSize","Diffuse map size",["Screen size",256,512,1024,2048,4096])),this._targetRenderersGUIElements.push(this._addSlider(s,r,"targets_minimumThickness","Minimum thickness",0,3,.001)),this._targetRenderersGUIElements.push(this._addCheckbox(s,r,"targets_useFixedThickness","Use fixed thickness")),this._targetRenderersGUIElements.push(this._addCheckbox(s,r,"targets_useVelocity","Use velocity"));const n=s.addFolder("Color");n.$title.style.fontStyle="italic",this._targetRenderersGUIElements.push(this._addCheckbox(n,r,"targets_generateDiffuseTexture","Generate diffuse texture")),this._targetRenderersGUIElements.push(this._addColor(n,r,"targets_fluidColor","Fluid color")),this._targetRenderersGUIElements.push(this._addColor(n,r,"targets_surfaceColor","Surface color")),this._targetRenderersGUIElements.push(this._addSlider(n,r,"targets_density","Density",0,20,.01)),this._targetRenderersGUIElements.push(this._addSlider(n,r,"targets_refractionStrength","Refraction strength",0,.3,.005)),this._targetRenderersGUIElements.push(this._addSlider(n,r,"targets_fresnelClamp","Fresnel clamp",0,1,.005)),this._targetRenderersGUIElements.push(this._addSlider(n,r,"targets_specularPower","Specular power",1,5e3,5));const d=s.addFolder("Blur Depth");d.$title.style.fontStyle="italic",this._targetRenderersGUIElements.push(this._addCheckbox(d,r,"targets_enableBlurDepth","Enable")),this._targetRenderersGUIElements.push(this._addSlider(d,r,"targets_blurDepthSizeDivisor","Size divisor",1,10,1)),this._targetRenderersGUIElements.push(this._addSlider(d,r,"targets_blurDepthFilterSize","Filter size",1,20,1)),this._targetRenderersGUIElements.push(this._addSlider(d,r,"targets_blurDepthNumIterations","Num iterations",1,10,1)),this._targetRenderersGUIElements.push(this._addSlider(d,r,"targets_blurDepthMaxFilterSize","Max filter size",1,100,1)),this._targetRenderersGUIElements.push(this._addSlider(d,r,"targets_blurDepthDepthScale","Depth scale",0,100,.01));const l=s.addFolder("Blur Thickness");l.$title.style.fontStyle="italic",this._targetRenderersGUIElements.push(this._addCheckbox(l,r,"targets_enableBlurThickness","Enable")),this._targetRenderersGUIElements.push(this._addSlider(l,r,"targets_blurThicknessSizeDivisor","Size divisor",1,10,1)),this._targetRenderersGUIElements.push(this._addSlider(l,r,"targets_blurThicknessFilterSize","Filter size",1,20,1)),this._targetRenderersGUIElements.push(this._addSlider(l,r,"targets_blurThicknessNumIterations","Num iterations",1,10,1));const h=s.addFolder("Debug");h.$title.style.fontStyle="italic",this._targetRenderersGUIElements.push(this._addCheckbox(h,r,"targets_debug","Enable")),this._targetRenderersGUIElements.push(this._addList(h,r,"targets_debugFeature","Feature",Object.keys(a.FluidRenderingDebug).filter((e=>isNaN(Number(e)))))),s.open()}_makeMenuRenderObjects(){var e,t;if(!this._gui||null===(t=null===(e=this._scene.fluidRenderer)||void 0===e?void 0:e.renderObjects.length)||void 0===t||!t)return;const r={objects_index:this._parameterRead("objects_index"),objects_particleSize:this._parameterRead("objects_particleSize"),objects_particleThicknessAlpha:this._parameterRead("objects_particleThicknessAlpha")},s=this._gui.addFolder("Render objects");s.$title.style.fontWeight="bold";const i=[];if(this._scene.fluidRenderer)for(let e=0;e<this._scene.fluidRenderer.renderObjects.length;++e)i.push(e);this._addList(s,r,"objects_index","Index",i),this._renderObjectsGUIElements.push(this._addSlider(s,r,"objects_particleSize","Particle size",0,2,.001)),this._renderObjectsGUIElements.push(this._addSlider(s,r,"objects_particleThicknessAlpha","Particle alpha",0,1,.001))}_readValue(e,t){const r=t.split("_");for(let t=0;t<r.length;++t){const i=r[t];(e=e[r[t]])instanceof s.Color3&&(e=e.toHexString()),"debugFeature"===i&&(e=a.FluidRenderingDebug[e]),i.endsWith("MapSize")&&null===e&&(e="Screen size")}return e}_setValue(e,t,r){const s=t.split("_");for(let t=0;t<s.length-1;++t)e=e[s[t]],s[t].endsWith("MapSize")&&"Screen size"===r&&(r=null);s[s.length-1].endsWith("MapSize")&&"Screen size"===r&&(r=null),e[s[s.length-1]]=r}_parameterRead(e){const t=this._scene.fluidRenderer;return"enable"===e?!!this._scene.fluidRenderer:e.startsWith("targets_")?"index"===(e=e.substring(8))?this._targetRendererIndex:t?this._readValue(t.targetRenderers[this._targetRendererIndex],e):"":e.startsWith("objects_")?"index"===(e=e.substring(8))?this._renderObjectIndex:t?this._readValue(t.renderObjects[this._renderObjectIndex].object,e):"":void 0}_fillValues(e,t){for(let r=0;r<e.length;++r){const s=e[r],i=s.property.split("_")[1];s.object[s.property]=this._readValue(t,i),s.updateDisplay()}}syncGUI(){const e=this._scene.fluidRenderer;e&&(this._fillValues(this._targetRenderersGUIElements,e.targetRenderers[this._targetRendererIndex]),this._fillValues(this._renderObjectsGUIElements,e.renderObjects[this._renderObjectIndex].object))}_parameterChanged(e,t){const r=this._scene.fluidRenderer;switch(e){case"enable":return void(t?(this._scene.enableFluidRenderer(),this._targetRendererIndex=0,this.initialize()):(this._scene.disableFluidRenderer(),this._targetRendererIndex=0,this.initialize()));case"targets_fluidColor":return void(r&&r.targetRenderers.length>this._targetRendererIndex&&r.targetRenderers[this._targetRendererIndex].fluidColor.copyFrom(s.Color3.FromHexString(t)));case"targets_surfaceColor":return void(r&&r.targetRenderers.length>this._targetRendererIndex&&r.targetRenderers[this._targetRendererIndex].surfaceColor.copyFrom(s.Color3.FromHexString(t)));case"targets_debugFeature":{const e=t,s=a.FluidRenderingDebug[e];return void(r&&r.targetRenderers.length>this._targetRendererIndex&&(r.targetRenderers[this._targetRendererIndex].debugFeature=s))}}e.startsWith("targets_")&&("index"===(e=e.substring(8))?(this._targetRendererIndex=t||0,r&&this._fillValues(this._targetRenderersGUIElements,r.targetRenderers[this._targetRendererIndex])):r&&this._setValue(r.targetRenderers[this._targetRendererIndex],e,!1!==t&&(!0===t||(isNaN(t)?t:parseFloat(t))))),e.startsWith("objects_")&&("index"===(e=e.substring(8))?(this._renderObjectIndex=t||0,r&&this._fillValues(this._renderObjectsGUIElements,r.renderObjects[this._renderObjectIndex].object)):r&&this._setValue(r.renderObjects[this._renderObjectIndex].object,e,!1!==t&&(!0===t||(isNaN(t)?t:parseFloat(t)))))}}}}]);
//# sourceMappingURL=692.9664937704772b8ee90b.js.map